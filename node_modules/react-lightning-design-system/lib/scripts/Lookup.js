'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LookupCandidateList = exports.LookupSearch = exports.LookupSelection = undefined;

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _getIterator2 = require('babel-runtime/core-js/get-iterator');

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _uuid = require('uuid');

var _uuid2 = _interopRequireDefault(_uuid);

var _FormElement = require('./FormElement');

var _FormElement2 = _interopRequireDefault(_FormElement);

var _Input = require('./Input');

var _Input2 = _interopRequireDefault(_Input);

var _Icon = require('./Icon');

var _Icon2 = _interopRequireDefault(_Icon);

var _Spinner = require('./Spinner');

var _Spinner2 = _interopRequireDefault(_Spinner);

var _Pill = require('./Pill');

var _Pill2 = _interopRequireDefault(_Pill);

var _DropdownButton = require('./DropdownButton');

var _DropdownButton2 = _interopRequireDefault(_DropdownButton);

var _DropdownMenu = require('./DropdownMenu');

var _util = require('./util');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var LookupSelection = exports.LookupSelection = function (_Component) {
  (0, _inherits3.default)(LookupSelection, _Component);

  function LookupSelection() {
    (0, _classCallCheck3.default)(this, LookupSelection);
    return (0, _possibleConstructorReturn3.default)(this, (LookupSelection.__proto__ || (0, _getPrototypeOf2.default)(LookupSelection)).apply(this, arguments));
  }

  (0, _createClass3.default)(LookupSelection, [{
    key: 'onKeyDown',
    value: function onKeyDown(e) {
      if (e.keyCode === 8 || e.keyCode === 46) {
        // Bacspace / DEL
        e.preventDefault();
        e.stopPropagation();
        if (this.props.onResetSelection) {
          this.props.onResetSelection();
        }
      }
    }
  }, {
    key: 'renderPill',
    value: function renderPill(selected) {
      var _this2 = this;

      var onPillClick = function onPillClick(e) {
        e.target.focus();
        e.preventDefault();
        e.stopPropagation();
      };
      return _react2.default.createElement(_Pill2.default, {
        id: this.props.id,
        truncate: true,
        pillRef: function pillRef(node) {
          return _this2.pill = node;
        },
        onKeyDown: this.onKeyDown.bind(this),
        onClick: onPillClick,
        tabIndex: 0,
        icon: selected.icon ? {
          category: selected.category,
          icon: selected.icon
        } : undefined,
        label: selected.label,
        onRemove: this.props.onResetSelection
      });
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          hidden = _props.hidden,
          selected = _props.selected,
          lookupSelectionRef = _props.lookupSelectionRef;

      var lookupClassNames = (0, _classnames2.default)({ 'slds-hide': hidden });
      return _react2.default.createElement(
        'div',
        { ref: lookupSelectionRef, className: lookupClassNames },
        _react2.default.createElement(
          'div',
          { className: 'slds-pill__container' },
          selected ? this.renderPill(selected) : undefined
        )
      );
    }
  }]);
  return LookupSelection;
}(_react.Component);

var LookupEntryType = _react.PropTypes.shape({
  category: _react.PropTypes.string,
  icon: _react.PropTypes.string,
  label: _react.PropTypes.string,
  value: _react.PropTypes.string
});

LookupSelection.propTypes = {
  id: _react.PropTypes.string,
  selected: LookupEntryType,
  hidden: _react.PropTypes.bool,
  onResetSelection: _react.PropTypes.func,
  lookupSelectionRef: _react.PropTypes.func
};

/**
 *
 */

var LookupSearch = exports.LookupSearch = function (_Component2) {
  (0, _inherits3.default)(LookupSearch, _Component2);

  function LookupSearch(props) {
    (0, _classCallCheck3.default)(this, LookupSearch);

    /* eslint-disable max-len */
    var _this3 = (0, _possibleConstructorReturn3.default)(this, (LookupSearch.__proto__ || (0, _getPrototypeOf2.default)(LookupSearch)).call(this, props));

    (0, _util.registerStyle)('lookupSearch', [['.slds-lookup[data-scope="multi"] .react-slds-lookup-scope-selector', '{ min-width: 3rem; }'], ['.slds-lookup[data-scope="multi"] .react-slds-lookup-scope-selector .slds-dropdown-trigger', '{ margin-left: 0; }'], ['.slds-lookup[data-scope="multi"] .react-slds-lookup-scope-selector .slds-dropdown-trigger .slds-button', '{ padding: 0 0.25rem; }'], ['.slds-lookup[data-scope="multi"] .slds-box--border', '{ background-color: white; }'], ['.slds-lookup[data-scope="multi"] .slds-box--border .slds-input--bare', '{ height: 2.15rem; width: 100%; }']]);
    return _this3;
  }

  (0, _createClass3.default)(LookupSearch, [{
    key: 'onLookupIconClick',
    value: function onLookupIconClick() {
      this.props.onSubmit();
    }
  }, {
    key: 'onInputKeyDown',
    value: function onInputKeyDown(e) {
      if (e.keyCode === 13) {
        // return key
        e.preventDefault();
        e.stopPropagation();
        var searchText = e.target.value;
        if (searchText) {
          this.props.onSubmit();
        } else {
          // if no search text, quit lookup search
          this.props.onComplete();
        }
      } else if (e.keyCode === 40) {
        // down key
        e.preventDefault();
        e.stopPropagation();
        this.props.onPressDown();
      } else if (e.keyCode === 27) {
        // ESC
        e.preventDefault();
        e.stopPropagation();
        // quit lookup search (cancel)
        var cancel = true;
        this.props.onComplete(cancel);
      }
      if (this.props.onKeyDown) {
        this.props.onKeyDown(e);
      }
    }
  }, {
    key: 'onInputChange',
    value: function onInputChange(e) {
      var searchText = e.target.value;
      this.props.onChange(searchText);
    }
  }, {
    key: 'onInputBlur',
    value: function onInputBlur(e) {
      if (this.props.onBlur) {
        this.props.onBlur(e);
      }
    }
  }, {
    key: 'onScopeMenuClick',
    value: function onScopeMenuClick(e) {
      if (this.props.onScopeMenuClick) {
        this.props.onScopeMenuClick(e);
      }
    }
  }, {
    key: 'onMenuItemClick',
    value: function onMenuItemClick(scope) {
      if (this.props.onScopeChange) {
        this.props.onScopeChange(scope.value);
      }
    }
  }, {
    key: 'renderSearchInput',
    value: function renderSearchInput(props) {
      var _this4 = this;

      var className = props.className,
          hidden = props.hidden,
          searchText = props.searchText,
          _props$iconAlign = props.iconAlign,
          iconAlign = _props$iconAlign === undefined ? 'right' : _props$iconAlign,
          lookupSearchRef = props.lookupSearchRef;

      var searchInputClassNames = (0, _classnames2.default)('slds-grid', 'slds-input-has-icon', 'slds-input-has-icon--' + iconAlign, { 'slds-hide': hidden }, className);
      var pprops = (0, _assign2.default)({}, props);
      delete pprops.iconAlign;
      delete pprops.searchText;
      delete pprops.targetScope;
      delete pprops.onScopeMenuClick;
      delete pprops.onScopeChange;
      delete pprops.onPressDown;
      delete pprops.onComplete;
      delete pprops.defaultTargetScope;
      delete pprops.onSearchTextChange;
      delete pprops.scopes;
      delete pprops.onLookupRequest;
      delete pprops.defaultSearchText;
      delete pprops.onValueChange;
      delete pprops.lookupSearchRef;
      return _react2.default.createElement(
        'div',
        { ref: lookupSearchRef, className: searchInputClassNames },
        _react2.default.createElement(_Input2.default, (0, _extends3.default)({}, pprops, {
          inputRef: function inputRef(node) {
            return _this4.input = node;
          },
          value: searchText,
          onKeyDown: this.onInputKeyDown.bind(this),
          onChange: this.onInputChange.bind(this),
          onBlur: this.onInputBlur.bind(this)
        })),
        _react2.default.createElement(_Icon2.default, {
          icon: 'search',
          className: 'slds-input__icon',
          style: { cursor: 'pointer' },
          onClick: this.onLookupIconClick.bind(this)
        })
      );
    }
  }, {
    key: 'renderScopeSelector',
    value: function renderScopeSelector(scopes, target) {
      var targetScope = scopes[0] || {};
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = (0, _getIterator3.default)(scopes), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var scope = _step.value;

          if (scope.value === target) {
            targetScope = scope;
            break;
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      var icon = _react2.default.createElement(_Icon2.default, { icon: targetScope.icon || 'none', size: 'x-small' });
      var selectorClassNames = (0, _classnames2.default)('slds-grid', 'slds-grid--align-center', 'slds-grid--vertical-align-center', 'react-slds-lookup-scope-selector');
      return _react2.default.createElement(
        'div',
        { className: selectorClassNames },
        _react2.default.createElement(
          _DropdownButton2.default,
          {
            label: icon,
            onClick: this.onScopeMenuClick.bind(this),
            onMenuItemClick: this.onMenuItemClick.bind(this),
            onBlur: this.onInputBlur.bind(this)
          },
          scopes.map(function (scope) {
            return _react2.default.createElement(_DropdownMenu.DropdownMenuItem, (0, _extends3.default)({ key: scope.value }, scope));
          })
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _props2 = this.props,
          scopes = _props2.scopes,
          hidden = _props2.hidden,
          targetScope = _props2.targetScope,
          lookupSearchRef = _props2.lookupSearchRef,
          props = (0, _objectWithoutProperties3.default)(_props2, ['scopes', 'hidden', 'targetScope', 'lookupSearchRef']);

      if (scopes) {
        var lookupSearchClassNames = (0, _classnames2.default)('slds-grid', 'slds-form-element__control', 'slds-box--border', { 'slds-hide': hidden });
        var styles = { WebkitFlexWrap: 'nowrap', msFlexWrap: 'nowrap', flexWrap: 'nowrap' };
        return _react2.default.createElement(
          'div',
          { ref: lookupSearchRef, className: lookupSearchClassNames, style: styles },
          this.renderScopeSelector(scopes, targetScope),
          this.renderSearchInput((0, _extends3.default)({}, props, { className: 'slds-col', bare: true }))
        );
      }
      return this.renderSearchInput(this.props);
    }
  }]);
  return LookupSearch;
}(_react.Component);

var ICON_ALIGNS = ['left', 'right'];

LookupSearch.propTypes = {
  className: _react.PropTypes.string,
  hidden: _react.PropTypes.bool,
  searchText: _react.PropTypes.string,
  scopes: _react.PropTypes.arrayOf(_react.PropTypes.shape({
    label: _react.PropTypes.string,
    value: _react.PropTypes.string,
    icon: _react.PropTypes.string
  })),
  targetScope: _react.PropTypes.any, // eslint-disable-line
  iconAlign: _react.PropTypes.oneOf(ICON_ALIGNS),
  onKeyDown: _react.PropTypes.func,
  onBlur: _react.PropTypes.func,
  onChange: _react.PropTypes.func,
  onScopeMenuClick: _react.PropTypes.func,
  onScopeChange: _react.PropTypes.func,
  onPressDown: _react.PropTypes.func,
  onSubmit: _react.PropTypes.func,
  onComplete: _react.PropTypes.func,
  lookupSearchRef: _react.PropTypes.func
};

/**
 *
 */

var LookupCandidateList = exports.LookupCandidateList = function (_Component3) {
  (0, _inherits3.default)(LookupCandidateList, _Component3);

  function LookupCandidateList() {
    (0, _classCallCheck3.default)(this, LookupCandidateList);
    return (0, _possibleConstructorReturn3.default)(this, (LookupCandidateList.__proto__ || (0, _getPrototypeOf2.default)(LookupCandidateList)).apply(this, arguments));
  }

  (0, _createClass3.default)(LookupCandidateList, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      if (this.props.focus) {
        this.focusToTargetItemEl(0);
      }
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate(prevProps) {
      if (this.props.focus && !prevProps.focus) {
        this.focusToTargetItemEl(0);
      }
    }
  }, {
    key: 'onSelect',
    value: function onSelect(entry) {
      if (this.props.onSelect) {
        this.props.onSelect(entry);
      }
    }
  }, {
    key: 'onKeyDown',
    value: function onKeyDown(e) {
      if (e.keyCode === 38 || e.keyCode === 40) {
        // UP/DOWN
        e.preventDefault();
        e.stopPropagation();
        var currentEl = e.target.parentElement;
        var itemEl = e.keyCode === 40 ? currentEl.nextSibling : currentEl.previousSibling;
        while (itemEl) {
          var anchorEl = itemEl.querySelector('.react-slds-candidate[tabIndex]');
          if (anchorEl && !anchorEl.disabled) {
            anchorEl.focus();
            return;
          }
          itemEl = e.keyCode === 40 ? itemEl.nextSibling : itemEl.previousSibling;
        }
      } else if (e.keyCode === 27) {
        // ESC
        e.preventDefault();
        e.stopPropagation();
        this.onSelect(null);
      }
    }
  }, {
    key: 'focusToTargetItemEl',
    value: function focusToTargetItemEl(index) {
      var el = this.node;
      var anchors = el.querySelectorAll('.react-slds-candidate[tabIndex]');
      if (anchors[index]) {
        anchors[index].focus();
      }
    }
  }, {
    key: 'renderCandidate',
    value: function renderCandidate(entry) {
      var _this6 = this;

      return _react2.default.createElement(
        'li',
        { className: 'slds-lookup__item', key: entry.value },
        _react2.default.createElement(
          'a',
          {
            className: 'slds-truncate react-slds-candidate',
            tabIndex: -1,
            role: 'option',
            onKeyDown: function onKeyDown(e) {
              return e.keyCode === 13 && _this6.onSelect(entry);
            },
            onBlur: this.props.onBlur,
            onClick: function onClick() {
              return _this6.onSelect(entry);
            }
          },
          entry.icon ? _react2.default.createElement(_Icon2.default, {
            category: entry.category,
            icon: entry.icon,
            size: 'small'
          }) : undefined,
          entry.label
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _this7 = this;

      var _props3 = this.props,
          _props3$data = _props3.data,
          data = _props3$data === undefined ? [] : _props3$data,
          hidden = _props3.hidden,
          loading = _props3.loading,
          header = _props3.header,
          footer = _props3.footer,
          _props3$filter = _props3.filter,
          filter = _props3$filter === undefined ? function () {
        return true;
      } : _props3$filter;

      var lookupMenuClassNames = (0, _classnames2.default)('slds-lookup__menu', { 'slds-hide': hidden, 'slds-show': !hidden });
      return _react2.default.createElement(
        'div',
        {
          ref: function ref(node) {
            return _this7.node = node;
          },
          className: lookupMenuClassNames,
          role: 'listbox',
          onKeyDown: this.onKeyDown.bind(this)
        },
        header ? _react2.default.createElement(
          'div',
          { className: 'slds-lookup__item' },
          header
        ) : undefined,
        _react2.default.createElement(
          'ul',
          { className: 'slds-lookup__list', role: 'presentation' },
          data.filter(filter).map(this.renderCandidate.bind(this)),
          loading ? _react2.default.createElement(
            'li',
            { className: 'slds-lookup__item', key: 'loading', style: { height: 20 } },
            _react2.default.createElement(_Spinner2.default, { container: false, size: 'small', style: { margin: '0 auto' } })
          ) : undefined
        ),
        footer ? _react2.default.createElement(
          'div',
          { className: 'slds-lookup__item' },
          footer
        ) : undefined
      );
    }
  }]);
  return LookupCandidateList;
}(_react.Component);

LookupCandidateList.propTypes = {
  data: _react.PropTypes.arrayOf(LookupEntryType),
  focus: _react.PropTypes.bool,
  loading: _react.PropTypes.bool,
  hidden: _react.PropTypes.bool,
  filter: _react.PropTypes.func,
  onSelect: _react.PropTypes.func,
  onBlur: _react.PropTypes.func,
  header: _react.PropTypes.node,
  footer: _react.PropTypes.node
};

/**
 *
 */

var Lookup = function (_Component4) {
  (0, _inherits3.default)(Lookup, _Component4);

  function Lookup(props) {
    (0, _classCallCheck3.default)(this, Lookup);

    var _this8 = (0, _possibleConstructorReturn3.default)(this, (Lookup.__proto__ || (0, _getPrototypeOf2.default)(Lookup)).call(this, props));

    _this8.state = {
      id: 'form-element-' + (0, _uuid2.default)(),
      selected: props.defaultSelected,
      opened: props.defaultOpened,
      searchText: props.defaultSearchText,
      targetScope: props.defaultTargetScope,
      focusFirstCandidate: false
    };
    return _this8;
  }

  (0, _createClass3.default)(Lookup, [{
    key: 'onScopeMenuClick',
    value: function onScopeMenuClick(e) {
      this.setState({ opened: false });
      if (this.props.onScopeMenuClick) {
        this.props.onScopeMenuClick(e);
      }
    }
  }, {
    key: 'onScopeChange',
    value: function onScopeChange(targetScope) {
      this.setState({ targetScope: targetScope });
      if (this.props.onScopeChange) {
        this.props.onScopeChange(targetScope);
      }
    }
  }, {
    key: 'onSearchTextChange',
    value: function onSearchTextChange(searchText) {
      this.setState({ searchText: searchText });
      if (this.props.onSearchTextChange) {
        this.props.onSearchTextChange(searchText);
      }
    }
  }, {
    key: 'onLookupRequest',
    value: function onLookupRequest(searchText) {
      this.setState({ opened: true });
      if (this.props.onLookupRequest) {
        this.props.onLookupRequest(searchText);
      }
    }
  }, {
    key: 'onResetSelection',
    value: function onResetSelection() {
      var _this9 = this;

      this.setState({ selected: null });
      if (this.props.onSelect) {
        this.props.onSelect(null);
      }
      this.onSearchTextChange('');
      this.onLookupRequest('');
      setTimeout(function () {
        var searchElem = _this9.search;
        var inputElem = searchElem.querySelector('input');
        inputElem.focus();
      }, 10);
    }
  }, {
    key: 'onLookupItemSelect',
    value: function onLookupItemSelect(selected) {
      var _this10 = this;

      if (selected) {
        this.setState({ selected: selected, opened: false });
        if (this.props.onSelect) {
          this.props.onSelect(selected);
        }
        setTimeout(function () {
          var selectionElem = _this10.selection;
          var pillElem = selectionElem.querySelector('a');
          if (pillElem) {
            pillElem.focus();
          }
        }, 10);
      } else {
        this.setState({ opened: false });
        setTimeout(function () {
          var searchElem = _this10.search;
          var inputElem = searchElem.querySelector('input');
          inputElem.focus();
        }, 10);
      }
      if (this.props.onComplete) {
        this.props.onComplete(); // tell the component container to quit lookup
      }
    }
  }, {
    key: 'onFocusFirstCandidate',
    value: function onFocusFirstCandidate() {
      var _this11 = this;

      var _props$opened = this.props.opened,
          opened = _props$opened === undefined ? this.state.opened : _props$opened;

      if (!opened) {
        this.onLookupRequest(this.state.searchText);
      } else {
        this.setState({ focusFirstCandidate: true });
        setTimeout(function () {
          _this11.setState({ focusFirstCandidate: false });
        }, 10);
      }
    }
  }, {
    key: 'onBlur',
    value: function onBlur() {
      var _this12 = this;

      setTimeout(function () {
        if (!_this12.isFocusedInComponent()) {
          _this12.setState({ opened: false });
          if (_this12.props.onBlur) {
            _this12.props.onBlur();
          }
          if (_this12.props.onComplete) {
            _this12.props.onComplete(true); // quit lookup (cancel)
          }
        }
      }, 10);
    }
  }, {
    key: 'isFocusedInComponent',
    value: function isFocusedInComponent() {
      var rootEl = this.node;
      var targetEl = document.activeElement;
      while (targetEl && targetEl !== rootEl) {
        targetEl = targetEl.parentNode;
      }
      return !!targetEl;
    }
  }, {
    key: 'render',
    value: function render() {
      var _this13 = this;

      var id = this.props.id || this.state.id;
      var _props4 = this.props,
          totalCols = _props4.totalCols,
          cols = _props4.cols,
          label = _props4.label,
          required = _props4.required,
          error = _props4.error,
          className = _props4.className,
          _props4$selected = _props4.selected,
          selected = _props4$selected === undefined ? this.state.selected : _props4$selected,
          _props4$opened = _props4.opened,
          opened = _props4$opened === undefined ? this.state.opened : _props4$opened,
          _props4$searchText = _props4.searchText,
          searchText = _props4$searchText === undefined ? this.state.searchText : _props4$searchText,
          _props4$targetScope = _props4.targetScope,
          targetScope = _props4$targetScope === undefined ? this.state.targetScope : _props4$targetScope,
          loading = _props4.loading,
          lookupFilter = _props4.lookupFilter,
          listHeader = _props4.listHeader,
          listFooter = _props4.listFooter,
          data = _props4.data,
          onComplete = _props4.onComplete,
          props = (0, _objectWithoutProperties3.default)(_props4, ['totalCols', 'cols', 'label', 'required', 'error', 'className', 'selected', 'opened', 'searchText', 'targetScope', 'loading', 'lookupFilter', 'listHeader', 'listFooter', 'data', 'onComplete']);

      var dropdown = _react2.default.createElement(LookupCandidateList, {
        ref: function ref(node) {
          return _this13.candidateList = node;
        },
        data: data,
        focus: this.state.focusFirstCandidate,
        hidden: !opened,
        loading: loading,
        filter: lookupFilter ? function (entry) {
          return lookupFilter(entry, searchText, targetScope);
        } : undefined,
        header: listHeader,
        footer: listFooter,
        onSelect: this.onLookupItemSelect.bind(this),
        onBlur: this.onBlur.bind(this)
      });
      var lookupClassNames = (0, _classnames2.default)('slds-lookup', { 'slds-has-selection': selected }, className);
      var formElemProps = { id: id, totalCols: totalCols, cols: cols, label: label, required: required, error: error, dropdown: dropdown };
      /* eslint-disable no-unused-vars */
      var defaultSelected = props.defaultSelected,
          defaultOpened = props.defaultOpened,
          defaultSearchText = props.defaultSearchText,
          defaultTargetScope = props.defaultTargetScope,
          onSelect = props.onSelect,
          onBlur = props.onBlur,
          onScopeChange = props.onScopeChange,
          onScopeMenuClick = props.onScopeMenuClick,
          onSearchTextChange = props.onSearchTextChange,
          onLookupRequest = props.onLookupRequest,
          searchProps = (0, _objectWithoutProperties3.default)(props, ['defaultSelected', 'defaultOpened', 'defaultSearchText', 'defaultTargetScope', 'onSelect', 'onBlur', 'onScopeChange', 'onScopeMenuClick', 'onSearchTextChange', 'onLookupRequest']);
      /* eslint-enable no-unused-vars */

      return _react2.default.createElement(
        _FormElement2.default,
        (0, _extends3.default)({ formElementRef: function formElementRef(node) {
            return _this13.node = node;
          } }, formElemProps),
        _react2.default.createElement(
          'div',
          {
            className: lookupClassNames,
            'data-select': 'single',
            'data-scope': props.scopes ? 'multi' : 'single',
            'data-typeahead': false
          },
          selected ? _react2.default.createElement(LookupSelection, {
            id: id,
            lookupSelectionRef: function lookupSelectionRef(node) {
              return _this13.selection = node;
            },
            selected: selected,
            onResetSelection: this.onResetSelection.bind(this)
          }) : _react2.default.createElement(LookupSearch, (0, _extends3.default)({}, searchProps, {
            id: id,
            lookupSearchRef: function lookupSearchRef(node) {
              return _this13.search = node;
            },
            searchText: searchText,
            targetScope: targetScope,
            onScopeMenuClick: this.onScopeMenuClick.bind(this),
            onScopeChange: this.onScopeChange.bind(this),
            onChange: this.onSearchTextChange.bind(this),
            onSubmit: function onSubmit() {
              return _this13.onLookupRequest(searchText);
            },
            onPressDown: this.onFocusFirstCandidate.bind(this),
            onComplete: onComplete,
            onBlur: this.onBlur.bind(this)
          }))
        )
      );
    }
  }]);
  return Lookup;
}(_react.Component);

exports.default = Lookup;


Lookup.propTypes = {
  id: _react.PropTypes.string,
  className: _react.PropTypes.string,
  label: _react.PropTypes.string,
  required: _react.PropTypes.bool,
  error: _FormElement2.default.propTypes.error,
  value: _react.PropTypes.string,
  defaultValue: _react.PropTypes.string,
  selected: LookupEntryType,
  defaultSelected: LookupEntryType,
  opened: _react.PropTypes.bool,
  defaultOpened: _react.PropTypes.bool,
  searchText: _react.PropTypes.string,
  defaultSearchText: _react.PropTypes.string,
  loading: _react.PropTypes.bool,
  data: _react.PropTypes.arrayOf(LookupEntryType),
  lookupFilter: _react.PropTypes.func,
  listHeader: _react.PropTypes.node,
  listFooter: _react.PropTypes.node,
  scopes: _react.PropTypes.arrayOf(_react.PropTypes.shape({
    label: _react.PropTypes.string,
    value: _react.PropTypes.string,
    icon: _react.PropTypes.string
  })),
  targetScope: _react.PropTypes.string,
  iconAlign: _react.PropTypes.oneOf(ICON_ALIGNS),
  defaultTargetScope: _react.PropTypes.string,
  onSearchTextChange: _react.PropTypes.func,
  onScopeMenuClick: _react.PropTypes.func,
  onScopeChange: _react.PropTypes.func,
  onLookupRequest: _react.PropTypes.func,
  onBlur: _react.PropTypes.func,
  onSelect: _react.PropTypes.func,
  onComplete: _react.PropTypes.func,
  totalCols: _react.PropTypes.number,
  cols: _react.PropTypes.number
};

Lookup.isFormElement = true;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL0xvb2t1cC5qcyJdLCJuYW1lcyI6WyJMb29rdXBTZWxlY3Rpb24iLCJlIiwia2V5Q29kZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwicHJvcHMiLCJvblJlc2V0U2VsZWN0aW9uIiwic2VsZWN0ZWQiLCJvblBpbGxDbGljayIsInRhcmdldCIsImZvY3VzIiwiaWQiLCJwaWxsIiwibm9kZSIsIm9uS2V5RG93biIsImJpbmQiLCJpY29uIiwiY2F0ZWdvcnkiLCJ1bmRlZmluZWQiLCJsYWJlbCIsImhpZGRlbiIsImxvb2t1cFNlbGVjdGlvblJlZiIsImxvb2t1cENsYXNzTmFtZXMiLCJyZW5kZXJQaWxsIiwiTG9va3VwRW50cnlUeXBlIiwic2hhcGUiLCJzdHJpbmciLCJ2YWx1ZSIsInByb3BUeXBlcyIsImJvb2wiLCJmdW5jIiwiTG9va3VwU2VhcmNoIiwib25TdWJtaXQiLCJzZWFyY2hUZXh0Iiwib25Db21wbGV0ZSIsIm9uUHJlc3NEb3duIiwiY2FuY2VsIiwib25DaGFuZ2UiLCJvbkJsdXIiLCJvblNjb3BlTWVudUNsaWNrIiwic2NvcGUiLCJvblNjb3BlQ2hhbmdlIiwiY2xhc3NOYW1lIiwiaWNvbkFsaWduIiwibG9va3VwU2VhcmNoUmVmIiwic2VhcmNoSW5wdXRDbGFzc05hbWVzIiwicHByb3BzIiwidGFyZ2V0U2NvcGUiLCJkZWZhdWx0VGFyZ2V0U2NvcGUiLCJvblNlYXJjaFRleHRDaGFuZ2UiLCJzY29wZXMiLCJvbkxvb2t1cFJlcXVlc3QiLCJkZWZhdWx0U2VhcmNoVGV4dCIsIm9uVmFsdWVDaGFuZ2UiLCJpbnB1dCIsIm9uSW5wdXRLZXlEb3duIiwib25JbnB1dENoYW5nZSIsIm9uSW5wdXRCbHVyIiwiY3Vyc29yIiwib25Mb29rdXBJY29uQ2xpY2siLCJzZWxlY3RvckNsYXNzTmFtZXMiLCJvbk1lbnVJdGVtQ2xpY2siLCJtYXAiLCJsb29rdXBTZWFyY2hDbGFzc05hbWVzIiwic3R5bGVzIiwiV2Via2l0RmxleFdyYXAiLCJtc0ZsZXhXcmFwIiwiZmxleFdyYXAiLCJyZW5kZXJTY29wZVNlbGVjdG9yIiwicmVuZGVyU2VhcmNoSW5wdXQiLCJiYXJlIiwiSUNPTl9BTElHTlMiLCJhcnJheU9mIiwiYW55Iiwib25lT2YiLCJMb29rdXBDYW5kaWRhdGVMaXN0IiwiZm9jdXNUb1RhcmdldEl0ZW1FbCIsInByZXZQcm9wcyIsImVudHJ5Iiwib25TZWxlY3QiLCJjdXJyZW50RWwiLCJwYXJlbnRFbGVtZW50IiwiaXRlbUVsIiwibmV4dFNpYmxpbmciLCJwcmV2aW91c1NpYmxpbmciLCJhbmNob3JFbCIsInF1ZXJ5U2VsZWN0b3IiLCJkaXNhYmxlZCIsImluZGV4IiwiZWwiLCJhbmNob3JzIiwicXVlcnlTZWxlY3RvckFsbCIsImRhdGEiLCJsb2FkaW5nIiwiaGVhZGVyIiwiZm9vdGVyIiwiZmlsdGVyIiwibG9va3VwTWVudUNsYXNzTmFtZXMiLCJyZW5kZXJDYW5kaWRhdGUiLCJoZWlnaHQiLCJtYXJnaW4iLCJMb29rdXAiLCJzdGF0ZSIsImRlZmF1bHRTZWxlY3RlZCIsIm9wZW5lZCIsImRlZmF1bHRPcGVuZWQiLCJmb2N1c0ZpcnN0Q2FuZGlkYXRlIiwic2V0U3RhdGUiLCJzZXRUaW1lb3V0Iiwic2VhcmNoRWxlbSIsInNlYXJjaCIsImlucHV0RWxlbSIsInNlbGVjdGlvbkVsZW0iLCJzZWxlY3Rpb24iLCJwaWxsRWxlbSIsImlzRm9jdXNlZEluQ29tcG9uZW50Iiwicm9vdEVsIiwidGFyZ2V0RWwiLCJkb2N1bWVudCIsImFjdGl2ZUVsZW1lbnQiLCJwYXJlbnROb2RlIiwidG90YWxDb2xzIiwiY29scyIsInJlcXVpcmVkIiwiZXJyb3IiLCJsb29rdXBGaWx0ZXIiLCJsaXN0SGVhZGVyIiwibGlzdEZvb3RlciIsImRyb3Bkb3duIiwiY2FuZGlkYXRlTGlzdCIsIm9uTG9va3VwSXRlbVNlbGVjdCIsImZvcm1FbGVtUHJvcHMiLCJzZWFyY2hQcm9wcyIsIm9uRm9jdXNGaXJzdENhbmRpZGF0ZSIs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a0IsaUJBQVVULElBOUJYO0FBK0JqQlcsaUJBQWUsaUJBQVVYLElBL0JSO0FBZ0NqQnFCLG1CQUFpQixpQkFBVXJCLElBaENWO0FBaUNqQlEsVUFBUSxpQkFBVVIsSUFqQ0Q7QUFrQ2pCaUQsWUFBVSxpQkFBVWpELElBbENIO0FBbUNqQkksY0FBWSxpQkFBVUosSUFuQ0w7QUFvQ2pCMkYsYUFBVyxpQkFBVWMsTUFwQ0o7QUFxQ2pCYixRQUFNLGlCQUFVYTtBQXJDQyxDQUFuQjs7QUF3Q0FsQyxPQUFPbUMsYUFBUCxHQUF1QixJQUF2QiIsImZpbGUiOiJMb29rdXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50LCBQcm9wVHlwZXMgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCB1dWlkIGZyb20gJ3V1aWQnO1xuaW1wb3J0IEZvcm1FbGVtZW50IGZyb20gJy4vRm9ybUVsZW1lbnQnO1xuaW1wb3J0IElucHV0IGZyb20gJy4vSW5wdXQnO1xuaW1wb3J0IEljb24gZnJvbSAnLi9JY29uJztcbmltcG9ydCBTcGlubmVyIGZyb20gJy4vU3Bpbm5lcic7XG5pbXBvcnQgUGlsbCBmcm9tICcuL1BpbGwnO1xuaW1wb3J0IERyb3Bkb3duQnV0dG9uIGZyb20gJy4vRHJvcGRvd25CdXR0b24nO1xuaW1wb3J0IHsgRHJvcGRvd25NZW51SXRlbSB9IGZyb20gJy4vRHJvcGRvd25NZW51JztcbmltcG9ydCB7IHJlZ2lzdGVyU3R5bGUgfSBmcm9tICcuL3V0aWwnO1xuXG5leHBvcnQgY2xhc3MgTG9va3VwU2VsZWN0aW9uIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgb25LZXlEb3duKGUpIHtcbiAgICBpZiAoZS5rZXlDb2RlID09PSA4IHx8IGUua2V5Q29kZSA9PT0gNDYpIHsgLy8gQmFjc3BhY2UgLyBERUxcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBpZiAodGhpcy5wcm9wcy5vblJlc2V0U2VsZWN0aW9uKSB7XG4gICAgICAgIHRoaXMucHJvcHMub25SZXNldFNlbGVjdGlvbigpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlbmRlclBpbGwoc2VsZWN0ZWQpIHtcbiAgICBjb25zdCBvblBpbGxDbGljayA9IChlKSA9PiB7XG4gICAgICBlLnRhcmdldC5mb2N1cygpO1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9O1xuICAgIHJldHVybiAoXG4gICAgICA8UGlsbFxuICAgICAgICBpZD17IHRoaXMucHJvcHMuaWQgfVxuICAgICAgICB0cnVuY2F0ZVxuICAgICAgICBwaWxsUmVmPXsgbm9kZSA9PiAodGhpcy5waWxsID0gbm9kZSkgfVxuICAgICAgICBvbktleURvd249eyB0aGlzLm9uS2V5RG93bi5iaW5kKHRoaXMpIH1cbiAgICAgICAgb25DbGljaz17IG9uUGlsbENsaWNrIH1cbiAgICAgICAgdGFiSW5kZXg9eyAwIH1cbiAgICAgICAgaWNvbj17c2VsZWN0ZWQuaWNvbiA/IHtcbiAgICAgICAgICBjYXRlZ29yeTogc2VsZWN0ZWQuY2F0ZWdvcnksXG4gICAgICAgICAgaWNvbjogc2VsZWN0ZWQuaWNvbixcbiAgICAgICAgfSA6IHVuZGVmaW5lZH1cbiAgICAgICAgbGFiZWw9eyBzZWxlY3RlZC5sYWJlbCB9XG4gICAgICAgIG9uUmVtb3ZlPXsgdGhpcy5wcm9wcy5vblJlc2V0U2VsZWN0aW9uIH1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGhpZGRlbiwgc2VsZWN0ZWQsIGxvb2t1cFNlbGVjdGlvblJlZiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBsb29rdXBDbGFzc05hbWVzID0gY2xhc3NuYW1lcyhcbiAgICAgIHsgJ3NsZHMtaGlkZSc6IGhpZGRlbiB9XG4gICAgKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiByZWY9eyBsb29rdXBTZWxlY3Rpb25SZWYgfSBjbGFzc05hbWU9eyBsb29rdXBDbGFzc05hbWVzIH0+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPSdzbGRzLXBpbGxfX2NvbnRhaW5lcic+XG4gICAgICAgICAgeyBzZWxlY3RlZCA/IHRoaXMucmVuZGVyUGlsbChzZWxlY3RlZCkgOiB1bmRlZmluZWQgfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxufVxuXG5jb25zdCBMb29rdXBFbnRyeVR5cGUgPSBQcm9wVHlwZXMuc2hhcGUoe1xuICBjYXRlZ29yeTogUHJvcFR5cGVzLnN0cmluZyxcbiAgaWNvbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgbGFiZWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxufSk7XG5cbkxvb2t1cFNlbGVjdGlvbi5wcm9wVHlwZXMgPSB7XG4gIGlkOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzZWxlY3RlZDogTG9va3VwRW50cnlUeXBlLFxuICBoaWRkZW46IFByb3BUeXBlcy5ib29sLFxuICBvblJlc2V0U2VsZWN0aW9uOiBQcm9wVHlwZXMuZnVuYyxcbiAgbG9va3VwU2VsZWN0aW9uUmVmOiBQcm9wVHlwZXMuZnVuYyxcbn07XG5cblxuLyoqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgTG9va3VwU2VhcmNoIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuICAgIHJlZ2lzdGVyU3R5bGUoJ2xvb2t1cFNlYXJjaCcsIFtcbiAgICAgIFtcbiAgICAgICAgJy5zbGRzLWxvb2t1cFtkYXRhLXNjb3BlPVwibXVsdGlcIl0gLnJlYWN0LXNsZHMtbG9va3VwLXNjb3BlLXNlbGVjdG9yJyxcbiAgICAgICAgJ3sgbWluLXdpZHRoOiAzcmVtOyB9JyxcbiAgICAgIF0sXG4gICAgICBbXG4gICAgICAgICcuc2xkcy1sb29rdXBbZGF0YS1zY29wZT1cIm11bHRpXCJdIC5yZWFjdC1zbGRzLWxvb2t1cC1zY29wZS1zZWxlY3RvciAuc2xkcy1kcm9wZG93bi10cmlnZ2VyJyxcbiAgICAgICAgJ3sgbWFyZ2luLWxlZnQ6IDA7IH0nLFxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgJy5zbGRzLWxvb2t1cFtkYXRhLXNjb3BlPVwibXVsdGlcIl0gLnJlYWN0LXNsZHMtbG9va3VwLXNjb3BlLXNlbGVjdG9yIC5zbGRzLWRyb3Bkb3duLXRyaWdnZXIgLnNsZHMtYnV0dG9uJyxcbiAgICAgICAgJ3sgcGFkZGluZzogMCAwLjI1cmVtOyB9JyxcbiAgICAgIF0sXG4gICAgICBbXG4gICAgICAgICcuc2xkcy1sb29rdXBbZGF0YS1zY29wZT1cIm11bHRpXCJdIC5zbGRzLWJveC0tYm9yZGVyJyxcbiAgICAgICAgJ3sgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IH0nLFxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgJy5zbGRzLWxvb2t1cFtkYXRhLXNjb3BlPVwibXVsdGlcIl0gLnNsZHMtYm94LS1ib3JkZXIgLnNsZHMtaW5wdXQtLWJhcmUnLFxuICAgICAgICAneyBoZWlnaHQ6IDIuMTVyZW07IHdpZHRoOiAxMDAlOyB9JyxcbiAgICAgIF0sXG4gICAgXSk7XG4gIH1cblxuICBvbkxvb2t1cEljb25DbGljaygpIHtcbiAgICB0aGlzLnByb3BzLm9uU3VibWl0KCk7XG4gIH1cblxuICBvbklucHV0S2V5RG93bihlKSB7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHsgLy8gcmV0dXJuIGtleVxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IHNlYXJjaFRleHQgPSBlLnRhcmdldC52YWx1ZTtcbiAgICAgIGlmIChzZWFyY2hUZXh0KSB7XG4gICAgICAgIHRoaXMucHJvcHMub25TdWJtaXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGlmIG5vIHNlYXJjaCB0ZXh0LCBxdWl0IGxvb2t1cCBzZWFyY2hcbiAgICAgICAgdGhpcy5wcm9wcy5vbkNvbXBsZXRlKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IDQwKSB7IC8vIGRvd24ga2V5XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgdGhpcy5wcm9wcy5vblByZXNzRG93bigpO1xuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSAyNykgeyAvLyBFU0NcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAvLyBxdWl0IGxvb2t1cCBzZWFyY2ggKGNhbmNlbClcbiAgICAgIGNvbnN0IGNhbmNlbCA9IHRydWU7XG4gICAgICB0aGlzLnByb3BzLm9uQ29tcGxldGUoY2FuY2VsKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJvcHMub25LZXlEb3duKSB7XG4gICAgICB0aGlzLnByb3BzLm9uS2V5RG93bihlKTtcbiAgICB9XG4gIH1cblxuICBvbklucHV0Q2hhbmdlKGUpIHtcbiAgICBjb25zdCBzZWFyY2hUZXh0ID0gZS50YXJnZXQudmFsdWU7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZShzZWFyY2hUZXh0KTtcbiAgfVxuXG4gIG9uSW5wdXRCbHVyKGUpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5vbkJsdXIpIHtcbiAgICAgIHRoaXMucHJvcHMub25CbHVyKGUpO1xuICAgIH1cbiAgfVxuXG4gIG9uU2NvcGVNZW51Q2xpY2soZSkge1xuICAgIGlmICh0aGlzLnByb3BzLm9uU2NvcGVNZW51Q2xpY2spIHtcbiAgICAgIHRoaXMucHJvcHMub25TY29wZU1lbnVDbGljayhlKTtcbiAgICB9XG4gIH1cblxuICBvbk1lbnVJdGVtQ2xpY2soc2NvcGUpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5vblNjb3BlQ2hhbmdlKSB7XG4gICAgICB0aGlzLnByb3BzLm9uU2NvcGVDaGFuZ2Uoc2NvcGUudmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlclNlYXJjaElucHV0KHByb3BzKSB7XG4gICAgY29uc3QgeyBjbGFzc05hbWUsIGhpZGRlbiwgc2VhcmNoVGV4dCwgaWNvbkFsaWduID0gJ3JpZ2h0JywgbG9va3VwU2VhcmNoUmVmIH0gPSBwcm9wcztcbiAgICBjb25zdCBzZWFyY2hJbnB1dENsYXNzTmFtZXMgPSBjbGFzc25hbWVzKFxuICAgICAgJ3NsZHMtZ3JpZCcsXG4gICAgICAnc2xkcy1pbnB1dC1oYXMtaWNvbicsXG4gICAgICBgc2xkcy1pbnB1dC1oYXMtaWNvbi0tJHtpY29uQWxpZ259YCxcbiAgICAgIHsgJ3NsZHMtaGlkZSc6IGhpZGRlbiB9LFxuICAgICAgY2xhc3NOYW1lXG4gICAgKTtcbiAgICBjb25zdCBwcHJvcHMgPSBPYmplY3QuYXNzaWduKHt9LCBwcm9wcyk7XG4gICAgZGVsZXRlIHBwcm9wcy5pY29uQWxpZ247XG4gICAgZGVsZXRlIHBwcm9wcy5zZWFyY2hUZXh0O1xuICAgIGRlbGV0ZSBwcHJvcHMudGFyZ2V0U2NvcGU7XG4gICAgZGVsZXRlIHBwcm9wcy5vblNjb3BlTWVudUNsaWNrO1xuICAgIGRlbGV0ZSBwcHJvcHMub25TY29wZUNoYW5nZTtcbiAgICBkZWxldGUgcHByb3BzLm9uUHJlc3NEb3duO1xuICAgIGRlbGV0ZSBwcHJvcHMub25Db21wbGV0ZTtcbiAgICBkZWxldGUgcHByb3BzLmRlZmF1bHRUYXJnZXRTY29wZTtcbiAgICBkZWxldGUgcHByb3BzLm9uU2VhcmNoVGV4dENoYW5nZTtcbiAgICBkZWxldGUgcHByb3BzLnNjb3BlcztcbiAgICBkZWxldGUgcHByb3BzLm9uTG9va3VwUmVxdWVzdDtcbiAgICBkZWxldGUgcHByb3BzLmRlZmF1bHRTZWFyY2hUZXh0O1xuICAgIGRlbGV0ZSBwcHJvcHMub25WYWx1ZUNoYW5nZTtcbiAgICBkZWxldGUgcHByb3BzLmxvb2t1cFNlYXJjaFJlZjtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiByZWY9eyBsb29rdXBTZWFyY2hSZWYgfSBjbGFzc05hbWU9eyBzZWFyY2hJbnB1dENsYXNzTmFtZXMgfT5cbiAgICAgICAgPElucHV0XG4gICAgICAgICAgeyAuLi5wcHJvcHMgfVxuICAgICAgICAgIGlucHV0UmVmPXsgbm9kZSA9PiAodGhpcy5pbnB1dCA9IG5vZGUpIH1cbiAgICAgICAgICB2YWx1ZT17IHNlYXJjaFRleHQgfVxuICAgICAgICAgIG9uS2V5RG93bj17IHRoaXMub25JbnB1dEtleURvd24uYmluZCh0aGlzKSB9XG4gICAgICAgICAgb25DaGFuZ2U9eyB0aGlzLm9uSW5wdXRDaGFuZ2UuYmluZCh0aGlzKSB9XG4gICAgICAgICAgb25CbHVyPXsgdGhpcy5vbklucHV0Qmx1ci5iaW5kKHRoaXMpIH1cbiAgICAgICAgLz5cbiAgICAgICAgPEljb25cbiAgICAgICAgICBpY29uPSdzZWFyY2gnXG4gICAgICAgICAgY2xhc3NOYW1lPSdzbGRzLWlucHV0X19pY29uJ1xuICAgICAgICAgIHN0eWxlPXsgeyBjdXJzb3I6ICdwb2ludGVyJyB9IH1cbiAgICAgICAgICBvbkNsaWNrPXsgdGhpcy5vbkxvb2t1cEljb25DbGljay5iaW5kKHRoaXMpIH1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXJTY29wZVNlbGVjdG9yKHNjb3BlcywgdGFyZ2V0KSB7XG4gICAgbGV0IHRhcmdldFNjb3BlID0gc2NvcGVzWzBdIHx8IHt9O1xuICAgIGZvciAoY29uc3Qgc2NvcGUgb2Ygc2NvcGVzKSB7XG4gICAgICBpZiAoc2NvcGUudmFsdWUgPT09IHRhcmdldCkge1xuICAgICAgICB0YXJnZXRTY29wZSA9IHNjb3BlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgaWNvbiA9IDxJY29uIGljb249eyB0YXJnZXRTY29wZS5pY29uIHx8ICdub25lJyB9IHNpemU9J3gtc21hbGwnIC8+O1xuICAgIGNvbnN0IHNlbGVjdG9yQ2xhc3NOYW1lcyA9IGNsYXNzbmFtZXMoXG4gICAgICAnc2xkcy1ncmlkJyxcbiAgICAgICdzbGRzLWdyaWQtLWFsaWduLWNlbnRlcicsXG4gICAgICAnc2xkcy1ncmlkLS12ZXJ0aWNhbC1hbGlnbi1jZW50ZXInLFxuICAgICAgJ3JlYWN0LXNsZHMtbG9va3VwLXNjb3BlLXNlbGVjdG9yJ1xuICAgICk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXsgc2VsZWN0b3JDbGFzc05hbWVzIH0+XG4gICAgICAgIDxEcm9wZG93bkJ1dHRvblxuICAgICAgICAgIGxhYmVsPXsgaWNvbiB9XG4gICAgICAgICAgb25DbGljaz17IHRoaXMub25TY29wZU1lbnVDbGljay5iaW5kKHRoaXMpIH1cbiAgICAgICAgICBvbk1lbnVJdGVtQ2xpY2s9eyB0aGlzLm9uTWVudUl0ZW1DbGljay5iaW5kKHRoaXMpIH1cbiAgICAgICAgICBvbkJsdXI9eyB0aGlzLm9uSW5wdXRCbHVyLmJpbmQodGhpcykgfVxuICAgICAgICA+XG4gICAgICAgICAgeyBzY29wZXMubWFwKHNjb3BlID0+IDxEcm9wZG93bk1lbnVJdGVtIGtleT17IHNjb3BlLnZhbHVlIH0geyAuLi5zY29wZSB9IC8+KSB9XG4gICAgICAgIDwvRHJvcGRvd25CdXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgc2NvcGVzLCBoaWRkZW4sIHRhcmdldFNjb3BlLCBsb29rdXBTZWFyY2hSZWYsIC4uLnByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChzY29wZXMpIHtcbiAgICAgIGNvbnN0IGxvb2t1cFNlYXJjaENsYXNzTmFtZXMgPSBjbGFzc25hbWVzKFxuICAgICAgICAnc2xkcy1ncmlkJyxcbiAgICAgICAgJ3NsZHMtZm9ybS1lbGVtZW50X19jb250cm9sJyxcbiAgICAgICAgJ3NsZHMtYm94LS1ib3JkZXInLFxuICAgICAgICB7ICdzbGRzLWhpZGUnOiBoaWRkZW4gfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHN0eWxlcyA9IHsgV2Via2l0RmxleFdyYXA6ICdub3dyYXAnLCBtc0ZsZXhXcmFwOiAnbm93cmFwJywgZmxleFdyYXA6ICdub3dyYXAnIH07XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IHJlZj17IGxvb2t1cFNlYXJjaFJlZiB9IGNsYXNzTmFtZT17IGxvb2t1cFNlYXJjaENsYXNzTmFtZXMgfSBzdHlsZT17IHN0eWxlcyB9PlxuICAgICAgICAgIHsgdGhpcy5yZW5kZXJTY29wZVNlbGVjdG9yKHNjb3BlcywgdGFyZ2V0U2NvcGUpIH1cbiAgICAgICAgICB7IHRoaXMucmVuZGVyU2VhcmNoSW5wdXQoeyAuLi5wcm9wcywgY2xhc3NOYW1lOiAnc2xkcy1jb2wnLCBiYXJlOiB0cnVlIH0pIH1cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5yZW5kZXJTZWFyY2hJbnB1dCh0aGlzLnByb3BzKTtcbiAgfVxuXG59XG5cbmNvbnN0IElDT05fQUxJR05TID0gWydsZWZ0JywgJ3JpZ2h0J107XG5cbkxvb2t1cFNlYXJjaC5wcm9wVHlwZXMgPSB7XG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgaGlkZGVuOiBQcm9wVHlwZXMuYm9vbCxcbiAgc2VhcmNoVGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgc2NvcGVzOiBQcm9wVHlwZXMuYXJyYXlPZihcbiAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgbGFiZWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICB2YWx1ZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIGljb246IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgfSlcbiAgKSxcbiAgdGFyZ2V0U2NvcGU6IFByb3BUeXBlcy5hbnksIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgaWNvbkFsaWduOiBQcm9wVHlwZXMub25lT2YoSUNPTl9BTElHTlMpLFxuICBvbktleURvd246IFByb3BUeXBlcy5mdW5jLFxuICBvbkJsdXI6IFByb3BUeXBlcy5mdW5jLFxuICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uU2NvcGVNZW51Q2xpY2s6IFByb3BUeXBlcy5mdW5jLFxuICBvblNjb3BlQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25QcmVzc0Rvd246IFByb3BUeXBlcy5mdW5jLFxuICBvblN1Ym1pdDogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uQ29tcGxldGU6IFByb3BUeXBlcy5mdW5jLFxuICBsb29rdXBTZWFyY2hSZWY6IFByb3BUeXBlcy5mdW5jLFxufTtcblxuLyoqXG4gKlxuICovXG5leHBvcnQgY2xhc3MgTG9va3VwQ2FuZGlkYXRlTGlzdCBleHRlbmRzIENvbXBvbmVudCB7XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuZm9jdXMpIHtcbiAgICAgIHRoaXMuZm9jdXNUb1RhcmdldEl0ZW1FbCgwKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuZm9jdXMgJiYgIXByZXZQcm9wcy5mb2N1cykge1xuICAgICAgdGhpcy5mb2N1c1RvVGFyZ2V0SXRlbUVsKDApO1xuICAgIH1cbiAgfVxuXG4gIG9uU2VsZWN0KGVudHJ5KSB7XG4gICAgaWYgKHRoaXMucHJvcHMub25TZWxlY3QpIHtcbiAgICAgIHRoaXMucHJvcHMub25TZWxlY3QoZW50cnkpO1xuICAgIH1cbiAgfVxuXG4gIG9uS2V5RG93bihlKSB7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMzggfHwgZS5rZXlDb2RlID09PSA0MCkgeyAvLyBVUC9ET1dOXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgY3VycmVudEVsID0gZS50YXJnZXQucGFyZW50RWxlbWVudDtcbiAgICAgIGxldCBpdGVtRWwgPSBlLmtleUNvZGUgPT09IDQwID8gY3VycmVudEVsLm5leHRTaWJsaW5nIDogY3VycmVudEVsLnByZXZpb3VzU2libGluZztcbiAgICAgIHdoaWxlIChpdGVtRWwpIHtcbiAgICAgICAgY29uc3QgYW5jaG9yRWwgPSBpdGVtRWwucXVlcnlTZWxlY3RvcignLnJlYWN0LXNsZHMtY2FuZGlkYXRlW3RhYkluZGV4XScpO1xuICAgICAgICBpZiAoYW5jaG9yRWwgJiYgIWFuY2hvckVsLmRpc2FibGVkKSB7XG4gICAgICAgICAgYW5jaG9yRWwuZm9jdXMoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaXRlbUVsID0gZS5rZXlDb2RlID09PSA0MCA/IGl0ZW1FbC5uZXh0U2libGluZyA6IGl0ZW1FbC5wcmV2aW91c1NpYmxpbmc7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IDI3KSB7IC8vIEVTQ1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMub25TZWxlY3QobnVsbCk7XG4gICAgfVxuICB9XG5cbiAgZm9jdXNUb1RhcmdldEl0ZW1FbChpbmRleCkge1xuICAgIGNvbnN0IGVsID0gdGhpcy5ub2RlO1xuICAgIGNvbnN0IGFuY2hvcnMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsKCcucmVhY3Qtc2xkcy1jYW5kaWRhdGVbdGFiSW5kZXhdJyk7XG4gICAgaWYgKGFuY2hvcnNbaW5kZXhdKSB7XG4gICAgICBhbmNob3JzW2luZGV4XS5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlckNhbmRpZGF0ZShlbnRyeSkge1xuICAgIHJldHVybiAoXG4gICAgICA8bGkgY2xhc3NOYW1lPSdzbGRzLWxvb2t1cF9faXRlbScga2V5PXsgZW50cnkudmFsdWUgfT5cbiAgICAgICAgPGFcbiAgICAgICAgICBjbGFzc05hbWU9J3NsZHMtdHJ1bmNhdGUgcmVhY3Qtc2xkcy1jYW5kaWRhdGUnXG4gICAgICAgICAgdGFiSW5kZXg9eyAtMSB9XG4gICAgICAgICAgcm9sZT0nb3B0aW9uJ1xuICAgICAgICAgIG9uS2V5RG93bj17IGUgPT4gZS5rZXlDb2RlID09PSAxMyAmJiB0aGlzLm9uU2VsZWN0KGVudHJ5KSB9XG4gICAgICAgICAgb25CbHVyPXsgdGhpcy5wcm9wcy5vbkJsdXIgfVxuICAgICAgICAgIG9uQ2xpY2s9eyAoKSA9PiB0aGlzLm9uU2VsZWN0KGVudHJ5KSB9XG4gICAgICAgID5cbiAgICAgICAgICB7XG4gICAgICAgICAgICBlbnRyeS5pY29uID9cbiAgICAgICAgICAgICAgPEljb25cbiAgICAgICAgICAgICAgICBjYXRlZ29yeT17IGVudHJ5LmNhdGVnb3J5IH1cbiAgICAgICAgICAgICAgICBpY29uPXsgZW50cnkuaWNvbiB9XG4gICAgICAgICAgICAgICAgc2l6ZT0nc21hbGwnXG4gICAgICAgICAgICAgIC8+IDpcbiAgICAgICAgICAgICAgdW5kZWZpbmVkXG4gICAgICAgICAgfVxuICAgICAgICAgIHsgZW50cnkubGFiZWwgfVxuICAgICAgICA8L2E+XG4gICAgICA8L2xpPlxuICAgICk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBkYXRhID0gW10sIGhpZGRlbiwgbG9hZGluZywgaGVhZGVyLCBmb290ZXIsIGZpbHRlciA9ICgpID0+IHRydWUgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbG9va3VwTWVudUNsYXNzTmFtZXMgPSBjbGFzc25hbWVzKFxuICAgICAgJ3NsZHMtbG9va3VwX19tZW51JyxcbiAgICAgIHsgJ3NsZHMtaGlkZSc6IGhpZGRlbiwgJ3NsZHMtc2hvdyc6ICFoaWRkZW4gfVxuICAgICk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAgcmVmPXsgbm9kZSA9PiAodGhpcy5ub2RlID0gbm9kZSkgfVxuICAgICAgICBjbGFzc05hbWU9eyBsb29rdXBNZW51Q2xhc3NOYW1lcyB9XG4gICAgICAgIHJvbGU9J2xpc3Rib3gnXG4gICAgICAgIG9uS2V5RG93bj17IHRoaXMub25LZXlEb3duLmJpbmQodGhpcykgfVxuICAgICAgPlxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyID9cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdzbGRzLWxvb2t1cF9faXRlbSc+eyBoZWFkZXIgfTwvZGl2PiA6XG4gICAgICAgICAgICB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgICA8dWwgY2xhc3NOYW1lPSdzbGRzLWxvb2t1cF9fbGlzdCcgcm9sZT0ncHJlc2VudGF0aW9uJz5cbiAgICAgICAgICB7XG4gICAgICAgICAgICBkYXRhLmZpbHRlcihmaWx0ZXIpLm1hcCh0aGlzLnJlbmRlckNhbmRpZGF0ZS5iaW5kKHRoaXMpKVxuICAgICAgICAgIH1cbiAgICAgICAgICB7XG4gICAgICAgICAgICBsb2FkaW5nID9cbiAgICAgICAgICAgICAgPGxpIGNsYXNzTmFtZT0nc2xkcy1sb29rdXBfX2l0ZW0nIGtleT0nbG9hZGluZycgc3R5bGU9eyB7IGhlaWdodDogMjAgfSB9PlxuICAgICAgICAgICAgICAgIDxTcGlubmVyIGNvbnRhaW5lcj17ZmFsc2V9IHNpemU9J3NtYWxsJyBzdHlsZT17IHsgbWFyZ2luOiAnMCBhdXRvJyB9IH0gLz5cbiAgICAgICAgICAgICAgPC9saT4gOlxuICAgICAgICAgICAgICB1bmRlZmluZWRcbiAgICAgICAgICB9XG4gICAgICAgIDwvdWw+XG4gICAgICAgIHtcbiAgICAgICAgICBmb290ZXIgP1xuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3NsZHMtbG9va3VwX19pdGVtJz57IGZvb3RlciB9PC9kaXY+IDpcbiAgICAgICAgICAgIHVuZGVmaW5lZFxuICAgICAgICB9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbn1cblxuTG9va3VwQ2FuZGlkYXRlTGlzdC5wcm9wVHlwZXMgPSB7XG4gIGRhdGE6IFByb3BUeXBlcy5hcnJheU9mKExvb2t1cEVudHJ5VHlwZSksXG4gIGZvY3VzOiBQcm9wVHlwZXMuYm9vbCxcbiAgbG9hZGluZzogUHJvcFR5cGVzLmJvb2wsXG4gIGhpZGRlbjogUHJvcFR5cGVzLmJvb2wsXG4gIGZpbHRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uU2VsZWN0OiBQcm9wVHlwZXMuZnVuYyxcbiAgb25CbHVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgaGVhZGVyOiBQcm9wVHlwZXMubm9kZSxcbiAgZm9vdGVyOiBQcm9wVHlwZXMubm9kZSxcbn07XG5cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMb29rdXAgZXh0ZW5kcyBDb21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgaWQ6IGBmb3JtLWVsZW1lbnQtJHt1dWlkKCl9YCxcbiAgICAgIHNlbGVjdGVkOiBwcm9wcy5kZWZhdWx0U2VsZWN0ZWQsXG4gICAgICBvcGVuZWQ6IHByb3BzLmRlZmF1bHRPcGVuZWQsXG4gICAgICBzZWFyY2hUZXh0OiBwcm9wcy5kZWZhdWx0U2VhcmNoVGV4dCxcbiAgICAgIHRhcmdldFNjb3BlOiBwcm9wcy5kZWZhdWx0VGFyZ2V0U2NvcGUsXG4gICAgICBmb2N1c0ZpcnN0Q2FuZGlkYXRlOiBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgb25TY29wZU1lbnVDbGljayhlKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW5lZDogZmFsc2UgfSk7XG4gICAgaWYgKHRoaXMucHJvcHMub25TY29wZU1lbnVDbGljaykge1xuICAgICAgdGhpcy5wcm9wcy5vblNjb3BlTWVudUNsaWNrKGUpO1xuICAgIH1cbiAgfVxuXG4gIG9uU2NvcGVDaGFuZ2UodGFyZ2V0U2NvcGUpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgdGFyZ2V0U2NvcGUgfSk7XG4gICAgaWYgKHRoaXMucHJvcHMub25TY29wZUNoYW5nZSkge1xuICAgICAgdGhpcy5wcm9wcy5vblNjb3BlQ2hhbmdlKHRhcmdldFNjb3BlKTtcbiAgICB9XG4gIH1cblxuICBvblNlYXJjaFRleHRDaGFuZ2Uoc2VhcmNoVGV4dCkge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2hUZXh0IH0pO1xuICAgIGlmICh0aGlzLnByb3BzLm9uU2VhcmNoVGV4dENoYW5nZSkge1xuICAgICAgdGhpcy5wcm9wcy5vblNlYXJjaFRleHRDaGFuZ2Uoc2VhcmNoVGV4dCk7XG4gICAgfVxuICB9XG5cbiAgb25Mb29rdXBSZXF1ZXN0KHNlYXJjaFRleHQpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgb3BlbmVkOiB0cnVlIH0pO1xuICAgIGlmICh0aGlzLnByb3BzLm9uTG9va3VwUmVxdWVzdCkge1xuICAgICAgdGhpcy5wcm9wcy5vbkxvb2t1cFJlcXVlc3Qoc2VhcmNoVGV4dCk7XG4gICAgfVxuICB9XG5cbiAgb25SZXNldFNlbGVjdGlvbigpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWQ6IG51bGwgfSk7XG4gICAgaWYgKHRoaXMucHJvcHMub25TZWxlY3QpIHtcbiAgICAgIHRoaXMucHJvcHMub25TZWxlY3QobnVsbCk7XG4gICAgfVxuICAgIHRoaXMub25TZWFyY2hUZXh0Q2hhbmdlKCcnKTtcbiAgICB0aGlzLm9uTG9va3VwUmVxdWVzdCgnJyk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCBzZWFyY2hFbGVtID0gdGhpcy5zZWFyY2g7XG4gICAgICBjb25zdCBpbnB1dEVsZW0gPSBzZWFyY2hFbGVtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgICBpbnB1dEVsZW0uZm9jdXMoKTtcbiAgICB9LCAxMCk7XG4gIH1cblxuICBvbkxvb2t1cEl0ZW1TZWxlY3Qoc2VsZWN0ZWQpIHtcbiAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBzZWxlY3RlZCwgb3BlbmVkOiBmYWxzZSB9KTtcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uU2VsZWN0KSB7XG4gICAgICAgIHRoaXMucHJvcHMub25TZWxlY3Qoc2VsZWN0ZWQpO1xuICAgICAgfVxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbkVsZW0gPSB0aGlzLnNlbGVjdGlvbjtcbiAgICAgICAgY29uc3QgcGlsbEVsZW0gPSBzZWxlY3Rpb25FbGVtLnF1ZXJ5U2VsZWN0b3IoJ2EnKTtcbiAgICAgICAgaWYgKHBpbGxFbGVtKSB7IHBpbGxFbGVtLmZvY3VzKCk7IH1cbiAgICAgIH0sIDEwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW5lZDogZmFsc2UgfSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VhcmNoRWxlbSA9IHRoaXMuc2VhcmNoO1xuICAgICAgICBjb25zdCBpbnB1dEVsZW0gPSBzZWFyY2hFbGVtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgICAgIGlucHV0RWxlbS5mb2N1cygpO1xuICAgICAgfSwgMTApO1xuICAgIH1cbiAgICBpZiAodGhpcy5wcm9wcy5vbkNvbXBsZXRlKSB7XG4gICAgICB0aGlzLnByb3BzLm9uQ29tcGxldGUoKTsgLy8gdGVsbCB0aGUgY29tcG9uZW50IGNvbnRhaW5lciB0byBxdWl0IGxvb2t1cFxuICAgIH1cbiAgfVxuXG4gIG9uRm9jdXNGaXJzdENhbmRpZGF0ZSgpIHtcbiAgICBjb25zdCB7IG9wZW5lZCA9IHRoaXMuc3RhdGUub3BlbmVkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICghb3BlbmVkKSB7XG4gICAgICB0aGlzLm9uTG9va3VwUmVxdWVzdCh0aGlzLnN0YXRlLnNlYXJjaFRleHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgZm9jdXNGaXJzdENhbmRpZGF0ZTogdHJ1ZSB9KTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZm9jdXNGaXJzdENhbmRpZGF0ZTogZmFsc2UgfSk7XG4gICAgICB9LCAxMCk7XG4gICAgfVxuICB9XG5cbiAgb25CbHVyKCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmlzRm9jdXNlZEluQ29tcG9uZW50KCkpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW5lZDogZmFsc2UgfSk7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uQmx1cikge1xuICAgICAgICAgIHRoaXMucHJvcHMub25CbHVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25Db21wbGV0ZSkge1xuICAgICAgICAgIHRoaXMucHJvcHMub25Db21wbGV0ZSh0cnVlKTsgLy8gcXVpdCBsb29rdXAgKGNhbmNlbClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIDEwKTtcbiAgfVxuXG4gIGlzRm9jdXNlZEluQ29tcG9uZW50KCkge1xuICAgIGNvbnN0IHJvb3RFbCA9IHRoaXMubm9kZTtcbiAgICBsZXQgdGFyZ2V0RWwgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgIHdoaWxlICh0YXJnZXRFbCAmJiB0YXJnZXRFbCAhPT0gcm9vdEVsKSB7XG4gICAgICB0YXJnZXRFbCA9IHRhcmdldEVsLnBhcmVudE5vZGU7XG4gICAgfVxuICAgIHJldHVybiAhIXRhcmdldEVsO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IGlkID0gdGhpcy5wcm9wcy5pZCB8fCB0aGlzLnN0YXRlLmlkO1xuICAgIGNvbnN0IHtcbiAgICAgIHRvdGFsQ29scywgY29scyxcbiAgICAgIGxhYmVsLCByZXF1aXJlZCwgZXJyb3IsXG4gICAgICBjbGFzc05hbWUsXG4gICAgICBzZWxlY3RlZCA9IHRoaXMuc3RhdGUuc2VsZWN0ZWQsXG4gICAgICBvcGVuZWQgPSB0aGlzLnN0YXRlLm9wZW5lZCxcbiAgICAgIHNlYXJjaFRleHQgPSB0aGlzLnN0YXRlLnNlYXJjaFRleHQsXG4gICAgICB0YXJnZXRTY29wZSA9IHRoaXMuc3RhdGUudGFyZ2V0U2NvcGUsXG4gICAgICBsb2FkaW5nLCBsb29rdXBGaWx0ZXIsXG4gICAgICBsaXN0SGVhZGVyLCBsaXN0Rm9vdGVyLFxuICAgICAgZGF0YSxcbiAgICAgIG9uQ29tcGxldGUsXG4gICAgICAuLi5wcm9wc1xuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGRyb3Bkb3duID0gKFxuICAgICAgPExvb2t1cENhbmRpZGF0ZUxpc3RcbiAgICAgICAgcmVmPXsgbm9kZSA9PiAodGhpcy5jYW5kaWRhdGVMaXN0ID0gbm9kZSkgfVxuICAgICAgICBkYXRhPXsgZGF0YSB9XG4gICAgICAgIGZvY3VzPXsgdGhpcy5zdGF0ZS5mb2N1c0ZpcnN0Q2FuZGlkYXRlIH1cbiAgICAgICAgaGlkZGVuPXsgIW9wZW5lZCB9XG4gICAgICAgIGxvYWRpbmc9eyBsb2FkaW5nIH1cbiAgICAgICAgZmlsdGVyPXsgbG9va3VwRmlsdGVyID8gZW50cnkgPT4gbG9va3VwRmlsdGVyKGVudHJ5LCBzZWFyY2hUZXh0LCB0YXJnZXRTY29wZSkgOiB1bmRlZmluZWQgfVxuICAgICAgICBoZWFkZXI9eyBsaXN0SGVhZGVyIH1cbiAgICAgICAgZm9vdGVyPXsgbGlzdEZvb3RlciB9XG4gICAgICAgIG9uU2VsZWN0PXsgdGhpcy5vbkxvb2t1cEl0ZW1TZWxlY3QuYmluZCh0aGlzKSB9XG4gICAgICAgIG9uQmx1cj17IHRoaXMub25CbHVyLmJpbmQodGhpcykgfVxuICAgICAgLz5cbiAgICApO1xuICAgIGNvbnN0IGxvb2t1cENsYXNzTmFtZXMgPSBjbGFzc25hbWVzKFxuICAgICAgJ3NsZHMtbG9va3VwJyxcbiAgICAgIHsgJ3NsZHMtaGFzLXNlbGVjdGlvbic6IHNlbGVjdGVkIH0sXG4gICAgICBjbGFzc05hbWVcbiAgICApO1xuICAgIGNvbnN0IGZvcm1FbGVtUHJvcHMgPSB7IGlkLCB0b3RhbENvbHMsIGNvbHMsIGxhYmVsLCByZXF1aXJlZCwgZXJyb3IsIGRyb3Bkb3duIH07XG4gICAgLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbiAgICBjb25zdCB7XG4gICAgICBkZWZhdWx0U2VsZWN0ZWQsIGRlZmF1bHRPcGVuZWQsIGRlZmF1bHRTZWFyY2hUZXh0LCBkZWZhdWx0VGFyZ2V0U2NvcGUsXG4gICAgICBvblNlbGVjdCwgb25CbHVyLCBvblNjb3BlQ2hhbmdlLCBvblNjb3BlTWVudUNsaWNrLCBvblNlYXJjaFRleHRDaGFuZ2UsIG9uTG9va3VwUmVxdWVzdCxcbiAgICAgIC4uLnNlYXJjaFByb3BzXG4gICAgfSA9IHByb3BzO1xuICAgIC8qIGVzbGludC1lbmFibGUgbm8tdW51c2VkLXZhcnMgKi9cbiAgICByZXR1cm4gKFxuICAgICAgPEZvcm1FbGVtZW50IGZvcm1FbGVtZW50UmVmPXsgbm9kZSA9PiAodGhpcy5ub2RlID0gbm9kZSkgfSB7IC4uLmZvcm1FbGVtUHJvcHMgfT5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzTmFtZT17IGxvb2t1cENsYXNzTmFtZXMgfVxuICAgICAgICAgIGRhdGEtc2VsZWN0PSdzaW5nbGUnXG4gICAgICAgICAgZGF0YS1zY29wZT17IHByb3BzLnNjb3BlcyA/ICdtdWx0aScgOiAnc2luZ2xlJyB9XG4gICAgICAgICAgZGF0YS10eXBlYWhlYWQ9eyBmYWxzZSB9XG4gICAgICAgID5cbiAgICAgICAgICB7XG4gICAgICAgICAgICBzZWxlY3RlZCA/XG4gICAgICAgICAgICAgIDxMb29rdXBTZWxlY3Rpb25cbiAgICAgICAgICAgICAgICBpZD17IGlkIH1cbiAgICAgICAgICAgICAgICBsb29rdXBTZWxlY3Rpb25SZWY9eyBub2RlID0+ICh0aGlzLnNlbGVjdGlvbiA9IG5vZGUpIH1cbiAgICAgICAgICAgICAgICBzZWxlY3RlZD17IHNlbGVjdGVkIH1cbiAgICAgICAgICAgICAgICBvblJlc2V0U2VsZWN0aW9uPXsgdGhpcy5vblJlc2V0U2VsZWN0aW9uLmJpbmQodGhpcykgfVxuICAgICAgICAgICAgICAvPiA6XG4gICAgICAgICAgICAgICAgPExvb2t1cFNlYXJjaFxuICAgICAgICAgICAgICAgICAgeyAuLi5zZWFyY2hQcm9wcyB9XG4gICAgICAgICAgICAgICAgICBpZD17IGlkIH1cbiAgICAgICAgICAgICAgICAgIGxvb2t1cFNlYXJjaFJlZj17IG5vZGUgPT4gKHRoaXMuc2VhcmNoID0gbm9kZSkgfVxuICAgICAgICAgICAgICAgICAgc2VhcmNoVGV4dD17IHNlYXJjaFRleHQgfVxuICAgICAgICAgICAgICAgICAgdGFyZ2V0U2NvcGU9eyB0YXJnZXRTY29wZSB9XG4gICAgICAgICAgICAgICAgICBvblNjb3BlTWVudUNsaWNrPXsgdGhpcy5vblNjb3BlTWVudUNsaWNrLmJpbmQodGhpcykgfVxuICAgICAgICAgICAgICAgICAgb25TY29wZUNoYW5nZT17IHRoaXMub25TY29wZUNoYW5nZS5iaW5kKHRoaXMpIH1cbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsgdGhpcy5vblNlYXJjaFRleHRDaGFuZ2UuYmluZCh0aGlzKSB9XG4gICAgICAgICAgICAgICAgICBvblN1Ym1pdD17ICgpID0+IHRoaXMub25Mb29rdXBSZXF1ZXN0KHNlYXJjaFRleHQpIH1cbiAgICAgICAgICAgICAgICAgIG9uUHJlc3NEb3duPXsgdGhpcy5vbkZvY3VzRmlyc3RDYW5kaWRhdGUuYmluZCh0aGlzKSB9XG4gICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlPXsgb25Db21wbGV0ZSB9XG4gICAgICAgICAgICAgICAgICBvbkJsdXI9eyB0aGlzLm9uQmx1ci5iaW5kKHRoaXMpIH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgIH1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L0Zvcm1FbGVtZW50PlxuICAgICk7XG4gIH1cbn1cblxuXG5Mb29rdXAucHJvcFR5cGVzID0ge1xuICBpZDogUHJvcFR5cGVzLnN0cmluZyxcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBsYWJlbDogUHJvcFR5cGVzLnN0cmluZyxcbiAgcmVxdWlyZWQ6IFByb3BUeXBlcy5ib29sLFxuICBlcnJvcjogRm9ybUVsZW1lbnQucHJvcFR5cGVzLmVycm9yLFxuICB2YWx1ZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgZGVmYXVsdFZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzZWxlY3RlZDogTG9va3VwRW50cnlUeXBlLFxuICBkZWZhdWx0U2VsZWN0ZWQ6IExvb2t1cEVudHJ5VHlwZSxcbiAgb3BlbmVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgZGVmYXVsdE9wZW5lZDogUHJvcFR5cGVzLmJvb2wsXG4gIHNlYXJjaFRleHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGRlZmF1bHRTZWFyY2hUZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICBsb2FkaW5nOiBQcm9wVHlwZXMuYm9vbCxcbiAgZGF0YTogUHJvcFR5cGVzLmFycmF5T2YoTG9va3VwRW50cnlUeXBlKSxcbiAgbG9va3VwRmlsdGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgbGlzdEhlYWRlcjogUHJvcFR5cGVzLm5vZGUsXG4gIGxpc3RGb290ZXI6IFByb3BUeXBlcy5ub2RlLFxuICBzY29wZXM6IFByb3BUeXBlcy5hcnJheU9mKFxuICAgIFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBsYWJlbDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgaWNvbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB9KVxuICApLFxuICB0YXJnZXRTY29wZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgaWNvbkFsaWduOiBQcm9wVHlwZXMub25lT2YoSUNPTl9BTElHTlMpLFxuICBkZWZhdWx0VGFyZ2V0U2NvcGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIG9uU2VhcmNoVGV4dENoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uU2NvcGVNZW51Q2xpY2s6IFByb3BUeXBlcy5mdW5jLFxuICBvblNjb3BlQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25Mb29rdXBSZXF1ZXN0OiBQcm9wVHlwZXMuZnVuYyxcbiAgb25CbHVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25TZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICBvbkNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcbiAgdG90YWxDb2xzOiBQcm9wVHlwZXMubnVtYmVyLFxuICBjb2xzOiBQcm9wVHlwZXMubnVtYmVyLFxufTtcblxuTG9va3VwLmlzRm9ybUVsZW1lbnQgPSB0cnVlO1xuIl19