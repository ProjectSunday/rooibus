'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TableRowColumnActions = exports.TableRowColumn = exports.TableHeaderColumn = exports.TableRow = exports.TableBody = exports.TableHeader = undefined;

var _defineProperty2 = require('babel-runtime/helpers/defineProperty');

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _classnames2 = require('classnames');

var _classnames3 = _interopRequireDefault(_classnames2);

var _Icon = require('./Icon');

var _Icon2 = _interopRequireDefault(_Icon);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var TableHeader = exports.TableHeader = function (_Component) {
  (0, _inherits3.default)(TableHeader, _Component);

  function TableHeader() {
    (0, _classCallCheck3.default)(this, TableHeader);
    return (0, _possibleConstructorReturn3.default)(this, (TableHeader.__proto__ || (0, _getPrototypeOf2.default)(TableHeader)).apply(this, arguments));
  }

  (0, _createClass3.default)(TableHeader, [{
    key: 'renderBaseHeaderRow',
    value: function renderBaseHeaderRow() {
      var _props = this.props,
          children = _props.children,
          sortable = _props.sortable,
          hasActions = _props.hasActions,
          actionsPosition = _props.actionsPosition;

      var nextChildren = [];

      var props = {
        className: 'slds-text-title--caps'
      };

      _react2.default.Children.forEach(children.props.children, function (child, index) {
        var childSortable = child.props.sortable;
        nextChildren.push(_react2.default.cloneElement(child, {
          key: index,
          sortable: typeof childSortable === 'undefined' ? sortable : childSortable
        }));
      });

      if (hasActions) {
        nextChildren = [].concat((0, _toConsumableArray3.default)(nextChildren.slice(0, actionsPosition)), [_react2.default.createElement(TableHeaderColumn, {
          sortable: false,
          width: 50,
          key: -1,
          className: 'slds-cell-shrink'
        })], (0, _toConsumableArray3.default)(nextChildren.slice(actionsPosition)));
      }

      return _react2.default.cloneElement(children, props, nextChildren);
    }
  }, {
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'thead',
        null,
        this.renderBaseHeaderRow()
      );
    }
  }]);
  return TableHeader;
}(_react.Component);

TableHeader.propTypes = {
  hasActions: _react.PropTypes.bool,
  actionsPosition: _react.PropTypes.number,
  children: _react.PropTypes.node,
  sortable: _react.PropTypes.bool
};

TableHeader.defaultProps = {
  actionsPosition: 0
};

var TableBody = exports.TableBody = function (_Component2) {
  (0, _inherits3.default)(TableBody, _Component2);

  function TableBody() {
    (0, _classCallCheck3.default)(this, TableBody);
    return (0, _possibleConstructorReturn3.default)(this, (TableBody.__proto__ || (0, _getPrototypeOf2.default)(TableBody)).apply(this, arguments));
  }

  (0, _createClass3.default)(TableBody, [{
    key: 'renderRows',
    value: function renderRows() {
      return _react2.default.Children.map(this.props.children, function (child) {
        var children = [];

        _react2.default.Children.forEach(child.props.children, function (innerChild, index) {
          if (!_react2.default.isValidElement(innerChild)) return;
          var truncate = innerChild.props.truncate;

          var props = {
            key: index
          };
          if (typeof truncate !== 'undefined') props.truncate = truncate;
          children.push(_react2.default.cloneElement(innerChild, props));
        });

        return _react2.default.cloneElement(child, { className: 'slds-hint-parent' }, children);
      });
    }
  }, {
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'tbody',
        null,
        this.renderRows()
      );
    }
  }]);
  return TableBody;
}(_react.Component);

TableBody.propTypes = {
  children: _react.PropTypes.node
};

var TableRow = function TableRow(_ref) {
  var selected = _ref.selected,
      props = (0, _objectWithoutProperties3.default)(_ref, ['selected']);
  var style = props.style;


  if (selected) {
    style = (0, _assign2.default)({}, style, {
      backgroundColor: '#F8FCF5',
      borderLeft: '2px solid #7db450'
    });
  }

  return _react2.default.createElement(
    'tr',
    (0, _extends3.default)({}, props, { style: style }),
    props.children
  );
};

exports.TableRow = TableRow;
TableRow.propTypes = {
  selected: _react.PropTypes.bool,
  children: _react.PropTypes.node,
  /* eslint-disable react/forbid-prop-types */
  style: _react.PropTypes.object
};

var TableHeaderColumn = function TableHeaderColumn(props) {
  var sortable = props.sortable,
      resizable = props.resizable,
      children = props.children,
      className = props.className,
      width = props.width,
      sortDir = props.sortDir,
      onSort = props.onSort,
      sorted = props.sorted,
      align = props.align,
      pprops = (0, _objectWithoutProperties3.default)(props, ['sortable', 'resizable', 'children', 'className', 'width', 'sortDir', 'onSort', 'sorted', 'align']);

  var oClassNames = (0, _classnames3.default)(className, 'slds-text-title--caps slds-truncate', (0, _defineProperty3.default)({
    'slds-is-sortable': sortable,
    'slds-is-resizable': resizable
  }, 'slds-text-align--' + align, align));

  var style = { minWidth: width || 'auto' };

  var buttonStyle = {};

  // TODO: SLDS doesn't have class for selected so will wait
  if (sorted) {
    style.backgroundColor = '#F4F6F9';
    style.color = '#0070d2';
    buttonStyle.visibility = 'visible';
  }

  var icon = sortDir === 'DESC' ? 'arrowdown' : 'arrowup';

  return _react2.default.createElement(
    'th',
    (0, _extends3.default)({}, pprops, {
      className: oClassNames,
      scope: 'col',
      style: style
    }),
    sortable ? _react2.default.createElement(
      'a',
      {
        onClick: function onClick(e) {
          e.preventDefault();onSort();
        },
        className: 'slds-th__action slds-text-link--reset'
      },
      _react2.default.createElement(
        'span',
        { className: 'slds-assistive-text' },
        'Sort '
      ),
      _react2.default.createElement(
        'span',
        { className: 'slds-truncate' },
        children
      ),
      _react2.default.createElement(_Icon2.default, {
        className: 'slds-is-sortable__icon',
        textColor: 'default',
        container: true,
        size: 'x-small',
        category: 'utility',
        icon: icon,
        style: { position: 'absolute' }
      }),
      _react2.default.createElement('span', { className: 'slds-assistive-text', 'aria-live': 'assertive', 'aria-atomic': 'true' })
    ) : children
  );
};

exports.TableHeaderColumn = TableHeaderColumn;
TableHeaderColumn.propTypes = {
  className: _react.PropTypes.string,
  onSort: _react.PropTypes.func,
  width: _react.PropTypes.oneOfType([_react2.default.PropTypes.string, _react2.default.PropTypes.number]),
  sortable: _react.PropTypes.bool,
  resizable: _react.PropTypes.bool,
  sortDir: _react.PropTypes.string,
  sorted: _react.PropTypes.bool,
  align: _react.PropTypes.oneOf(['left', 'center', 'right']),
  children: _react.PropTypes.node
};

var TableRowColumn = function TableRowColumn(props) {
  var truncate = props.truncate,
      className = props.className,
      children = props.children,
      pprops = (0, _objectWithoutProperties3.default)(props, ['truncate', 'className', 'children']);

  var oClassNames = (0, _classnames3.default)(className, {
    'slds-truncate': truncate
  });
  var style = {};
  if (!truncate) style.position = 'static';

  return _react2.default.createElement(
    'td',
    (0, _extends3.default)({
      role: 'gridcell',
      style: style,
      className: oClassNames
    }, pprops),
    children
  );
};

exports.TableRowColumn = TableRowColumn;
TableRowColumn.propTypes = {
  className: _react.PropTypes.string,
  truncate: _react.PropTypes.bool,
  children: _react.PropTypes.node
};

TableRowColumn.defaultProps = {
  truncate: true
};

var TableRowColumnActions = exports.TableRowColumnActions = function TableRowColumnActions(props) {
  return _react2.default.createElement(
    TableRowColumn,
    {
      className: 'slds-cell-shrink',
      'data-label': 'Actions',
      truncate: false,
      width: 50,
      style: { position: 'static' }
    },
    props.children
  );
};

TableRowColumnActions.propTypes = {
  children: _react.PropTypes.node
};

var Table = function (_Component3) {
  (0, _inherits3.default)(Table, _Component3);

  function Table() {
    (0, _classCallCheck3.default)(this, Table);
    return (0, _possibleConstructorReturn3.default)(this, (Table.__proto__ || (0, _getPrototypeOf2.default)(Table)).apply(this, arguments));
  }

  (0, _createClass3.default)(Table, [{
    key: 'onScroll',
    value: function onScroll() {
      var elements = document.getElementsByClassName('react-slds-dropdown-opened');
      if (elements.length) elements[0].childNodes[0].blur();
    }
  }, {
    key: 'renderTableHeader',
    value: function renderTableHeader(base) {
      var sortable = this.props.sortable;

      return _react2.default.cloneElement(base, { sortable: sortable });
    }
  }, {
    key: 'renderTableBody',
    value: function renderTableBody(base) {
      return base;
    }
  }, {
    key: 'render',
    value: function render() {
      var _this4 = this;

      var _props2 = this.props,
          className = _props2.className,
          bordered = _props2.bordered,
          verticalBorders = _props2.verticalBorders,
          noRowHover = _props2.noRowHover,
          striped = _props2.striped,
          fixedLayout = _props2.fixedLayout,
          children = _props2.children,
          autoWidth = _props2.autoWidth,
          wrapperStyle = _props2.wrapperStyle,
          pprops = (0, _objectWithoutProperties3.default)(_props2, ['className', 'bordered', 'verticalBorders', 'noRowHover', 'striped', 'fixedLayout', 'children', 'autoWidth', 'wrapperStyle']);

      delete pprops.sortable;

      var tableClassNames = (0, _classnames3.default)(className, 'slds-table slds-table--cell-buffer', {
        'slds-table--bordered': bordered,
        'slds-no-row-hover': noRowHover,
        'slds-table--striped': striped,
        'slds-table--fixed-layout': fixedLayout,
        'slds-table--col-bordered': verticalBorders
      });

      var wrapStyle = (0, _assign2.default)({
        overflowY: 'hidden',
        overflowX: 'auto'
      }, wrapperStyle);

      var style = {};
      if (autoWidth) style.width = 'auto';

      var tBody = void 0;
      var tHead = void 0;

      _react2.default.Children.forEach(children, function (child) {
        if (!_react2.default.isValidElement(child)) return;
        if (child.type === TableHeader) {
          tHead = _this4.renderTableHeader(child);
        } else if (child.type === TableBody) {
          tBody = _this4.renderTableBody(child);
        }
      });

      return _react2.default.createElement(
        'div',
        null,
        _react2.default.createElement(
          'div',
          { style: wrapStyle, onScroll: this.onScroll.bind(this) },
          _react2.default.createElement(
            'table',
            (0, _extends3.default)({ className: tableClassNames, style: style }, pprops),
            tHead,
            tBody
          )
        )
      );
    }
  }]);
  return Table;
}(_react.Component);

Table.propTypes = {
  wrapperStyle: _react.PropTypes.object,
  className: _react.PropTypes.string,
  bordered: _react.PropTypes.bool,
  verticalBorders: _react.PropTypes.bool,
  noRowHover: _react.PropTypes.bool,
  striped: _react.PropTypes.bool,
  fixedLayout: _react.PropTypes.bool,
  sortable: _react.PropTypes.bool,
  children: _react.PropTypes.node,
  autoWidth: _react.PropTypes.bool
};

exports.default = Table;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL1RhYmxlLmpzIl0sIm5hbWVzIjpbIlRhYmxlSGVhZGVyIiwicHJvcHMiLCJjaGlsZHJlbiIsInNvcnRhYmxlIiwiaGFzQWN0aW9ucyIsImFjdGlvbnNQb3NpdGlvbiIsIm5leHRDaGlsZHJlbiIsImNsYXNzTmFtZSIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsImNoaWxkIiwiaW5kZXgiLCJjaGlsZFNvcnRhYmxlIiwicHVzaCIsImNsb25lRWxlbWVudCIsImtleSIsInNsaWNlIiwicmVuZGVyQmFzZUhlYWRlclJvdyIsInByb3BUeXBlcyIsImJvb2wiLCJudW1iZXIiLCJub2RlIiwiZGVmYXVsdFByb3BzIiwiVGFibGVCb2R5IiwibWFwIiwiaW5uZXJDaGlsZCIsImlzVmFsaWRFbGVtZW50IiwidHJ1bmNhdGUiLCJyZW5kZXJSb3dzIiwiVGFibGVSb3ciLCJzZWxlY3RlZCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwiYm9yZGVyTGVmdCIsIm9iamVjdCIsIlRhYmxlSGVhZGVyQ29sdW1uIiwicmVzaXphYmxlIiwid2lkdGgiLCJzb3J0RGlyIiwib25Tb3J0Iiwic29ydGVkIiwiYWxpZ24iLCJwcHJvcHMiLCJvQ2xhc3NOYW1lcyIsIm1pbldpZHRoIiwiYnV0dG9uU3R5bGUiLCJjb2xvciIsInZpc2liaWxpdHkiLCJpY29uIiwiZSIsInByZXZlbnREZWZhdWx0IiwicG9zaXRpb24iLCJzdHJpbmciLCJmdW5jIiwib25lT2ZUeXBlIiwiUHJvcFR5cGVzIiwib25lT2YiLCJUYWJsZVJvd0NvbHVtbiIsIlRhYmxlUm93Q29sdW1uQWN0aW9ucyIsIlRhYmxlIiwiZWxlbWVudHMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJsZW5ndGgiLCJjaGlsZE5vZGVzIiwiYmx1ciIsImJhc2UiLCJib3JkZXJlZCIsInZlcnRpY2FsQm9yZGVycyIsIm5vUm93SG92ZXIiLCJzdHJpcGVkIiwiZml4ZWRMYXlvdXQiLCJhdXRvV2lkdGgiLCJ3cmFwcGVyU3R5bGUiLCJ0YWJsZUNsYXNzTmFtZXMiLCJ3cmFwU3R5bGUiLCJvdmVyZmxvd1kiLCJvdmVyZmxvd1giLCJ0Qm9keSIsInRIZWFkIiwidHlwZSIsInJlbmRlclRhYmxlSGVhZGVyIiwicmVuZGVyVGFibGVCb2R5Iiwib25TY3JvbGwiLCJiaW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFFQTs7Ozs7O0lBRWFBLFcsV0FBQUEsVzs7Ozs7Ozs7OzswQ0FDVztBQUFBLG1CQUN3QyxLQUFLQyxLQUQ3QztBQUFBLFVBQ1pDLFFBRFksVUFDWkEsUUFEWTtBQUFBLFVBQ0ZDLFFBREUsVUFDRkEsUUFERTtBQUFBLFVBQ1FDLFVBRFIsVUFDUUEsVUFEUjtBQUFBLFVBQ29CQyxlQURwQixVQUNvQkEsZUFEcEI7O0FBRXBCLFVBQUlDLGVBQWUsRUFBbkI7O0FBRUEsVUFBTUwsUUFBUTtBQUNaTSxtQkFBVztBQURDLE9BQWQ7O0FBSUEsc0JBQU1DLFFBQU4sQ0FBZUMsT0FBZixDQUF1QlAsU0FBU0QsS0FBVCxDQUFlQyxRQUF0QyxFQUFnRCxVQUFDUSxLQUFELEVBQVFDLEtBQVIsRUFBa0I7QUFDaEUsWUFBTUMsZ0JBQWdCRixNQUFNVCxLQUFOLENBQVlFLFFBQWxDO0FBQ0FHLHFCQUFhTyxJQUFiLENBQWtCLGdCQUFNQyxZQUFOLENBQW1CSixLQUFuQixFQUEwQjtBQUMxQ0ssZUFBS0osS0FEcUM7QUFFMUNSLG9CQUFVLE9BQU9TLGFBQVAsS0FBeUIsV0FBekIsR0FBdUNULFFBQXZDLEdBQWtEUztBQUZsQixTQUExQixDQUFsQjtBQUlELE9BTkQ7O0FBUUEsVUFBSVIsVUFBSixFQUFnQjtBQUNkRSxrRUFDS0EsYUFBYVUsS0FBYixDQUFtQixDQUFuQixFQUFzQlgsZUFBdEIsQ0FETCxJQUVFLDhCQUFDLGlCQUFEO0FBQ0Usb0JBQVUsS0FEWjtBQUVFLGlCQUFPLEVBRlQ7QUFHRSxl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S0UsaUJBQUwsQ0FBdUJ2RSxLQUF2QixDQUFSO0FBQ0QsU0FGRCxNQUVPLElBQUlBLE1BQU1zRSxJQUFOLEtBQWV6RCxTQUFuQixFQUE4QjtBQUNuQ3VELGtCQUFRLE9BQUtJLGVBQUwsQ0FBcUJ4RSxLQUFyQixDQUFSO0FBQ0Q7QUFDRixPQVBEOztBQVNBLGFBQ0U7QUFBQTtBQUFBO0FBQ0U7QUFBQTtBQUFBLFlBQUssT0FBUWlFLFNBQWIsRUFBeUIsVUFBVSxLQUFLUSxRQUFMLENBQWNDLElBQWQsQ0FBbUIsSUFBbkIsQ0FBbkM7QUFDRTtBQUFBO0FBQUEscUNBQU8sV0FBV1YsZUFBbEIsRUFBbUMsT0FBTzNDLEtBQTFDLElBQXFEVyxNQUFyRDtBQUNHcUMsaUJBREg7QUFFR0Q7QUFGSDtBQURGO0FBREYsT0FERjtBQVVEOzs7OztBQUdIbkIsTUFBTXpDLFNBQU4sR0FBa0I7QUFDaEJ1RCxnQkFBYyxpQkFBVXZDLE1BRFI7QUFFaEIzQixhQUFXLGlCQUFVNkMsTUFGTDtBQUdoQmUsWUFBVSxpQkFBVWhELElBSEo7QUFJaEJpRCxtQkFBaUIsaUJBQVVqRCxJQUpYO0FBS2hCa0QsY0FBWSxpQkFBVWxELElBTE47QUFNaEJtRCxXQUFTLGlCQUFVbkQsSUFOSDtBQU9oQm9ELGVBQWEsaUJBQVVwRCxJQVBQO0FBUWhCaEIsWUFBVSxpQkFBVWdCLElBUko7QUFTaEJqQixZQUFVLGlCQUFVbUIsSUFUSjtBQVVoQm1ELGFBQVcsaUJBQVVyRDtBQVZMLENBQWxCOztrQkFhZXdDLEsiLCJmaWxlIjoiVGFibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHJvcFR5cGVzLCBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcblxuaW1wb3J0IEljb24gZnJvbSAnLi9JY29uJztcblxuZXhwb3J0IGNsYXNzIFRhYmxlSGVhZGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcmVuZGVyQmFzZUhlYWRlclJvdygpIHtcbiAgICBjb25zdCB7IGNoaWxkcmVuLCBzb3J0YWJsZSwgaGFzQWN0aW9ucywgYWN0aW9uc1Bvc2l0aW9uIH0gPSB0aGlzLnByb3BzO1xuICAgIGxldCBuZXh0Q2hpbGRyZW4gPSBbXTtcblxuICAgIGNvbnN0IHByb3BzID0ge1xuICAgICAgY2xhc3NOYW1lOiAnc2xkcy10ZXh0LXRpdGxlLS1jYXBzJyxcbiAgICB9O1xuXG4gICAgUmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbi5wcm9wcy5jaGlsZHJlbiwgKGNoaWxkLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgY2hpbGRTb3J0YWJsZSA9IGNoaWxkLnByb3BzLnNvcnRhYmxlO1xuICAgICAgbmV4dENoaWxkcmVuLnB1c2goUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkLCB7XG4gICAgICAgIGtleTogaW5kZXgsXG4gICAgICAgIHNvcnRhYmxlOiB0eXBlb2YgY2hpbGRTb3J0YWJsZSA9PT0gJ3VuZGVmaW5lZCcgPyBzb3J0YWJsZSA6IGNoaWxkU29ydGFibGUsXG4gICAgICB9KSk7XG4gICAgfSk7XG5cbiAgICBpZiAoaGFzQWN0aW9ucykge1xuICAgICAgbmV4dENoaWxkcmVuID0gW1xuICAgICAgICAuLi5uZXh0Q2hpbGRyZW4uc2xpY2UoMCwgYWN0aW9uc1Bvc2l0aW9uKSxcbiAgICAgICAgPFRhYmxlSGVhZGVyQ29sdW1uXG4gICAgICAgICAgc29ydGFibGU9e2ZhbHNlfVxuICAgICAgICAgIHdpZHRoPXs1MH1cbiAgICAgICAgICBrZXk9ey0xfVxuICAgICAgICAgIGNsYXNzTmFtZT0nc2xkcy1jZWxsLXNocmluaydcbiAgICAgICAgLz4sXG4gICAgICAgIC4uLm5leHRDaGlsZHJlbi5zbGljZShhY3Rpb25zUG9zaXRpb24pLFxuICAgICAgXTtcbiAgICB9XG5cbiAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkcmVuLCBwcm9wcywgbmV4dENoaWxkcmVuKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPHRoZWFkPlxuICAgICAgICB7IHRoaXMucmVuZGVyQmFzZUhlYWRlclJvdygpIH1cbiAgICAgIDwvdGhlYWQ+XG4gICAgKTtcbiAgfVxufVxuXG5UYWJsZUhlYWRlci5wcm9wVHlwZXMgPSB7XG4gIGhhc0FjdGlvbnM6IFByb3BUeXBlcy5ib29sLFxuICBhY3Rpb25zUG9zaXRpb246IFByb3BUeXBlcy5udW1iZXIsXG4gIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgc29ydGFibGU6IFByb3BUeXBlcy5ib29sLFxufTtcblxuVGFibGVIZWFkZXIuZGVmYXVsdFByb3BzID0ge1xuICBhY3Rpb25zUG9zaXRpb246IDAsXG59O1xuXG5leHBvcnQgY2xhc3MgVGFibGVCb2R5IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcmVuZGVyUm93cygpIHtcbiAgICByZXR1cm4gUmVhY3QuQ2hpbGRyZW4ubWFwKHRoaXMucHJvcHMuY2hpbGRyZW4sIChjaGlsZCkgPT4ge1xuICAgICAgY29uc3QgY2hpbGRyZW4gPSBbXTtcblxuICAgICAgUmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZC5wcm9wcy5jaGlsZHJlbiwgKGlubmVyQ2hpbGQsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmICghUmVhY3QuaXNWYWxpZEVsZW1lbnQoaW5uZXJDaGlsZCkpIHJldHVybjtcbiAgICAgICAgY29uc3QgeyB0cnVuY2F0ZSB9ID0gaW5uZXJDaGlsZC5wcm9wcztcbiAgICAgICAgY29uc3QgcHJvcHMgPSB7XG4gICAgICAgICAga2V5OiBpbmRleCxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHR5cGVvZiB0cnVuY2F0ZSAhPT0gJ3VuZGVmaW5lZCcpIHByb3BzLnRydW5jYXRlID0gdHJ1bmNhdGU7XG4gICAgICAgIGNoaWxkcmVuLnB1c2goUmVhY3QuY2xvbmVFbGVtZW50KGlubmVyQ2hpbGQsIHByb3BzKSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZCwgeyBjbGFzc05hbWU6ICdzbGRzLWhpbnQtcGFyZW50JyB9LCBjaGlsZHJlbik7XG4gICAgfSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDx0Ym9keT5cbiAgICAgICAgeyB0aGlzLnJlbmRlclJvd3MoKSB9XG4gICAgICA8L3Rib2R5PlxuICAgICk7XG4gIH1cbn1cblxuVGFibGVCb2R5LnByb3BUeXBlcyA9IHtcbiAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxufTtcblxuZXhwb3J0IGNvbnN0IFRhYmxlUm93ID0gKHsgc2VsZWN0ZWQsIC4uLnByb3BzIH0pID0+IHtcbiAgbGV0IHsgc3R5bGUgfSA9IHByb3BzO1xuXG4gIGlmIChzZWxlY3RlZCkge1xuICAgIHN0eWxlID0gT2JqZWN0LmFzc2lnbih7fSwgc3R5bGUsIHtcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJyNGOEZDRjUnLFxuICAgICAgYm9yZGVyTGVmdDogJzJweCBzb2xpZCAjN2RiNDUwJyxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPHRyIHsuLi5wcm9wc30gc3R5bGU9e3N0eWxlfT5cbiAgICAgIHtwcm9wcy5jaGlsZHJlbn1cbiAgICA8L3RyPlxuICApO1xufTtcblxuVGFibGVSb3cucHJvcFR5cGVzID0ge1xuICBzZWxlY3RlZDogUHJvcFR5cGVzLmJvb2wsXG4gIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgLyogZXNsaW50LWRpc2FibGUgcmVhY3QvZm9yYmlkLXByb3AtdHlwZXMgKi9cbiAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG59O1xuXG5leHBvcnQgY29uc3QgVGFibGVIZWFkZXJDb2x1bW4gPSAocHJvcHMpID0+IHtcbiAgY29uc3Qge1xuICAgIHNvcnRhYmxlLCByZXNpemFibGUsIGNoaWxkcmVuLCBjbGFzc05hbWUsIHdpZHRoLCBzb3J0RGlyLCBvblNvcnQsIHNvcnRlZCwgYWxpZ24sIC4uLnBwcm9wc1xuICB9ID0gcHJvcHM7XG4gIGNvbnN0IG9DbGFzc05hbWVzID0gY2xhc3NuYW1lcyhjbGFzc05hbWUsXG4gICAgJ3NsZHMtdGV4dC10aXRsZS0tY2FwcyBzbGRzLXRydW5jYXRlJywge1xuICAgICAgJ3NsZHMtaXMtc29ydGFibGUnOiBzb3J0YWJsZSxcbiAgICAgICdzbGRzLWlzLXJlc2l6YWJsZSc6IHJlc2l6YWJsZSxcbiAgICAgIFtgc2xkcy10ZXh0LWFsaWduLS0ke2FsaWdufWBdOiBhbGlnbixcbiAgICB9KTtcblxuICBjb25zdCBzdHlsZSA9IHsgbWluV2lkdGg6IHdpZHRoIHx8ICdhdXRvJyB9O1xuXG4gIGNvbnN0IGJ1dHRvblN0eWxlID0ge307XG5cbiAgLy8gVE9ETzogU0xEUyBkb2Vzbid0IGhhdmUgY2xhc3MgZm9yIHNlbGVjdGVkIHNvIHdpbGwgd2FpdFxuICBpZiAoc29ydGVkKSB7XG4gICAgc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNGNEY2RjknO1xuICAgIHN0eWxlLmNvbG9yID0gJyMwMDcwZDInO1xuICAgIGJ1dHRvblN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG4gIH1cblxuICBjb25zdCBpY29uID0gc29ydERpciA9PT0gJ0RFU0MnID8gJ2Fycm93ZG93bicgOiAnYXJyb3d1cCc7XG5cbiAgcmV0dXJuIChcbiAgICA8dGhcbiAgICAgIHsuLi5wcHJvcHN9XG4gICAgICBjbGFzc05hbWU9e29DbGFzc05hbWVzfVxuICAgICAgc2NvcGU9J2NvbCdcbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICA+XG4gICAgICB7c29ydGFibGUgP1xuICAgICAgICA8YVxuICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgb25Tb3J0KCk7IH0gfVxuICAgICAgICAgIGNsYXNzTmFtZT0nc2xkcy10aF9fYWN0aW9uIHNsZHMtdGV4dC1saW5rLS1yZXNldCdcbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0nc2xkcy1hc3Npc3RpdmUtdGV4dCc+U29ydCA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSdzbGRzLXRydW5jYXRlJz57Y2hpbGRyZW59PC9zcGFuPlxuICAgICAgICAgIDxJY29uXG4gICAgICAgICAgICBjbGFzc05hbWU9J3NsZHMtaXMtc29ydGFibGVfX2ljb24nXG4gICAgICAgICAgICB0ZXh0Q29sb3I9J2RlZmF1bHQnXG4gICAgICAgICAgICBjb250YWluZXJcbiAgICAgICAgICAgIHNpemU9J3gtc21hbGwnXG4gICAgICAgICAgICBjYXRlZ29yeT0ndXRpbGl0eSdcbiAgICAgICAgICAgIGljb249e2ljb259XG4gICAgICAgICAgICBzdHlsZT17eyBwb3NpdGlvbjogJ2Fic29sdXRlJyB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSdzbGRzLWFzc2lzdGl2ZS10ZXh0JyBhcmlhLWxpdmU9J2Fzc2VydGl2ZScgYXJpYS1hdG9taWM9J3RydWUnIC8+XG4gICAgICAgIDwvYT5cbiAgICAgICAgOiBjaGlsZHJlblxuICAgICAgfVxuICAgIDwvdGg+XG4gICk7XG59O1xuXG5UYWJsZUhlYWRlckNvbHVtbi5wcm9wVHlwZXMgPSB7XG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgb25Tb3J0OiBQcm9wVHlwZXMuZnVuYyxcbiAgd2lkdGg6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgIFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgUmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgXSksXG4gIHNvcnRhYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgcmVzaXphYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgc29ydERpcjogUHJvcFR5cGVzLnN0cmluZyxcbiAgc29ydGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgYWxpZ246IFByb3BUeXBlcy5vbmVPZihbJ2xlZnQnLCAnY2VudGVyJywgJ3JpZ2h0J10pLFxuICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG59O1xuXG5leHBvcnQgY29uc3QgVGFibGVSb3dDb2x1bW4gPSAocHJvcHMpID0+IHtcbiAgY29uc3QgeyB0cnVuY2F0ZSwgY2xhc3NOYW1lLCBjaGlsZHJlbiwgLi4ucHByb3BzIH0gPSBwcm9wcztcbiAgY29uc3Qgb0NsYXNzTmFtZXMgPSBjbGFzc25hbWVzKGNsYXNzTmFtZSwge1xuICAgICdzbGRzLXRydW5jYXRlJzogdHJ1bmNhdGUsXG4gIH0pO1xuICBjb25zdCBzdHlsZSA9IHt9O1xuICBpZiAoIXRydW5jYXRlKSBzdHlsZS5wb3NpdGlvbiA9ICdzdGF0aWMnO1xuXG4gIHJldHVybiAoXG4gICAgPHRkXG4gICAgICByb2xlPSdncmlkY2VsbCdcbiAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIGNsYXNzTmFtZT17b0NsYXNzTmFtZXN9XG4gICAgICB7Li4ucHByb3BzfVxuICAgID57Y2hpbGRyZW59PC90ZD5cbiAgKTtcbn07XG5cblRhYmxlUm93Q29sdW1uLnByb3BUeXBlcyA9IHtcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB0cnVuY2F0ZTogUHJvcFR5cGVzLmJvb2wsXG4gIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbn07XG5cblRhYmxlUm93Q29sdW1uLmRlZmF1bHRQcm9wcyA9IHtcbiAgdHJ1bmNhdGU6IHRydWUsXG59O1xuXG5leHBvcnQgY29uc3QgVGFibGVSb3dDb2x1bW5BY3Rpb25zID0gcHJvcHMgPT4gKFxuICA8VGFibGVSb3dDb2x1bW5cbiAgICBjbGFzc05hbWU9J3NsZHMtY2VsbC1zaHJpbmsnXG4gICAgZGF0YS1sYWJlbD0nQWN0aW9ucydcbiAgICB0cnVuY2F0ZT17ZmFsc2V9XG4gICAgd2lkdGg9ezUwfVxuICAgIHN0eWxlPXt7IHBvc2l0aW9uOiAnc3RhdGljJyB9fVxuICA+XG4gICAge3Byb3BzLmNoaWxkcmVufVxuICA8L1RhYmxlUm93Q29sdW1uPlxuKTtcblxuVGFibGVSb3dDb2x1bW5BY3Rpb25zLnByb3BUeXBlcyA9IHtcbiAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxufTtcblxuY2xhc3MgVGFibGUgZXh0ZW5kcyBDb21wb25lbnQge1xuXG4gIG9uU2Nyb2xsKCkge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncmVhY3Qtc2xkcy1kcm9wZG93bi1vcGVuZWQnKTtcbiAgICBpZiAoZWxlbWVudHMubGVuZ3RoKSBlbGVtZW50c1swXS5jaGlsZE5vZGVzWzBdLmJsdXIoKTtcbiAgfVxuXG4gIHJlbmRlclRhYmxlSGVhZGVyKGJhc2UpIHtcbiAgICBjb25zdCB7IHNvcnRhYmxlIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoYmFzZSwgeyBzb3J0YWJsZSB9KTtcbiAgfVxuICByZW5kZXJUYWJsZUJvZHkoYmFzZSkge1xuICAgIHJldHVybiBiYXNlO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNsYXNzTmFtZSwgYm9yZGVyZWQsIHZlcnRpY2FsQm9yZGVycywgbm9Sb3dIb3Zlciwgc3RyaXBlZCwgZml4ZWRMYXlvdXQsXG4gICAgICBjaGlsZHJlbiwgYXV0b1dpZHRoLCB3cmFwcGVyU3R5bGUsIC4uLnBwcm9wc1xuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGRlbGV0ZSBwcHJvcHMuc29ydGFibGU7XG5cbiAgICBjb25zdCB0YWJsZUNsYXNzTmFtZXMgPSBjbGFzc25hbWVzKFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgJ3NsZHMtdGFibGUgc2xkcy10YWJsZS0tY2VsbC1idWZmZXInLFxuICAgICAge1xuICAgICAgICAnc2xkcy10YWJsZS0tYm9yZGVyZWQnOiBib3JkZXJlZCxcbiAgICAgICAgJ3NsZHMtbm8tcm93LWhvdmVyJzogbm9Sb3dIb3ZlcixcbiAgICAgICAgJ3NsZHMtdGFibGUtLXN0cmlwZWQnOiBzdHJpcGVkLFxuICAgICAgICAnc2xkcy10YWJsZS0tZml4ZWQtbGF5b3V0JzogZml4ZWRMYXlvdXQsXG4gICAgICAgICdzbGRzLXRhYmxlLS1jb2wtYm9yZGVyZWQnOiB2ZXJ0aWNhbEJvcmRlcnMsXG4gICAgICB9XG4gICAgKTtcblxuICAgIGNvbnN0IHdyYXBTdHlsZSA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgb3ZlcmZsb3dZOiAnaGlkZGVuJyxcbiAgICAgIG92ZXJmbG93WDogJ2F1dG8nLFxuICAgIH0sIHdyYXBwZXJTdHlsZSk7XG5cbiAgICBjb25zdCBzdHlsZSA9IHt9O1xuICAgIGlmIChhdXRvV2lkdGgpIHN0eWxlLndpZHRoID0gJ2F1dG8nO1xuXG4gICAgbGV0IHRCb2R5O1xuICAgIGxldCB0SGVhZDtcblxuICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIChjaGlsZCkgPT4ge1xuICAgICAgaWYgKCFSZWFjdC5pc1ZhbGlkRWxlbWVudChjaGlsZCkpIHJldHVybjtcbiAgICAgIGlmIChjaGlsZC50eXBlID09PSBUYWJsZUhlYWRlcikge1xuICAgICAgICB0SGVhZCA9IHRoaXMucmVuZGVyVGFibGVIZWFkZXIoY2hpbGQpO1xuICAgICAgfSBlbHNlIGlmIChjaGlsZC50eXBlID09PSBUYWJsZUJvZHkpIHtcbiAgICAgICAgdEJvZHkgPSB0aGlzLnJlbmRlclRhYmxlQm9keShjaGlsZCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdj5cbiAgICAgICAgPGRpdiBzdHlsZT17IHdyYXBTdHlsZSB9IG9uU2Nyb2xsPXt0aGlzLm9uU2Nyb2xsLmJpbmQodGhpcyl9PlxuICAgICAgICAgIDx0YWJsZSBjbGFzc05hbWU9e3RhYmxlQ2xhc3NOYW1lc30gc3R5bGU9e3N0eWxlfSB7Li4ucHByb3BzfT5cbiAgICAgICAgICAgIHt0SGVhZH1cbiAgICAgICAgICAgIHt0Qm9keX1cbiAgICAgICAgICA8L3RhYmxlPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cblxuVGFibGUucHJvcFR5cGVzID0ge1xuICB3cmFwcGVyU3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgYm9yZGVyZWQ6IFByb3BUeXBlcy5ib29sLFxuICB2ZXJ0aWNhbEJvcmRlcnM6IFByb3BUeXBlcy5ib29sLFxuICBub1Jvd0hvdmVyOiBQcm9wVHlwZXMuYm9vbCxcbiAgc3RyaXBlZDogUHJvcFR5cGVzLmJvb2wsXG4gIGZpeGVkTGF5b3V0OiBQcm9wVHlwZXMuYm9vbCxcbiAgc29ydGFibGU6IFByb3BUeXBlcy5ib29sLFxuICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG4gIGF1dG9XaWR0aDogUHJvcFR5cGVzLmJvb2wsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBUYWJsZTtcbiJdfQ==